<!--
  ~ The MIT License (MIT)
  ~
  ~ Copyright (c) 2019 ????????????[smallbun] www.smallbun.org
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of
  ~ this software and associated documentation files (the "Software"), to deal in
  ~ the Software without restriction, including without limitation the rights to
  ~ use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
  ~ the Software, and to permit persons to whom the Software is furnished to do so,
  ~ subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
  ~ FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
  ~ COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
  ~ IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  ~ CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<!DOCTYPE HTML>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="fragments/include :: header('部门管理')"></div>
    <div th:include="fragments/include :: bootstrap-table-css"></div>
<link rel="stylesheet" href="/static/common/plugins/layui/css/layui.css" media="all">
</head>

<body class="list-body">
<section class="content">
    <div class="ibox">
        <!--盒子标题-->
        <div class="ibox-title dashboard-header gray-bg">
            <h5>部门管理</h5>
            <div class="pull-right">
                <div class="pull-left">
                  <!--   <button type="button" id="expandAllBtn" class="btn btn-sm ibtn-primary"
                            onclick="$.treeTable.expandOrCollapse()">
                        <i class="fa fa-exchange"></i>&nbsp;展开/折叠
                    </button> -->
                    <!--/*/  <th:block sec:authorize="hasAuthority('manage:org:add')">/*/-->
                    <button type="button" class="btn btn-sm  ibtn-info"
                            onclick="add()">
                        <i class="fa fa-plus"></i>&nbsp;添加
                    </button>
                  <!--   <!--/*/     </th:block>/*/-->
                    /*/    <th:block sec:authorize="hasAuthority('manage:org:edit')">/*/
                    <button type="button" class="btn btn-sm bg-orange"
                            onclick="edit()">
                        <i class="fa fa-file-text-o"></i>&nbsp;修改
                    </button>
                    /*/     </th:block>/*/
                    /*/      <th:block sec:authorize="hasAuthority('manage:org:del')">/*/
                    <button type="button" class="btn btn-sm  bg-maroon"
                            onclick="batRemove()"><i
                            class="fa fa-trash-o"></i>&nbsp;删除
                    </button> -->
                    <!--/*/     </th:block>/*/-->
                </div>
            </div>
        </div>
        <!--盒子内容-->
        <div class="ibox-content-table">
             <table id="table" lay-filter="demo" class="table table-bordered table-striped"
                           data-mobile-responsive="true"  ></table>
          <script id="barDemo" type="text/html">
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-primary" lay-event="detail">查看</a>
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal" lay-event="edit">修改</a>
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-danger" lay-event="del">删除</a>
					</script> 
        </div>
    </div>
</section>
</body>
<script src="../static/common/plugins/jquery-3.1.1.min.js"></script>
<div th:include="fragments/include :: include-js"></div>
<div th:include="fragments/include :: bootstrap-table-js"></div>
<script src="../static/common/plugins/layui/layui.js"></script>
<script src="../static/common/plugins/layui/layui.all.js"></script>
<script src="../static/common/js/common.js"></script>
<script type="text/javascript" th:inline="none">
var table;
var editObj=null,ptable=null,treeGrid=null,tableId='table',layer=null;
layui.config({
    base: 'static/common/js/'
}).extend({
    treeGrid:'treeGrid'
}).use(['jquery','treeGrid','layer'], function(){
	  var $=layui.jquery;
      treeGrid = layui.treeGrid;//很重要
      layer=layui.layer;
      treeGrid.render({
	    elem: '#table'
	    ,idField:'id'
	    ,height: 520
	    ,url: contextPath + 'org/list' 
	    ,method: 'post'
	    ,page: false
	    ,iconOpen:false//是否显示图标【默认显示】
        ,isOpenDefault:true//节点默认是展开还是折叠【默认展开】
	    ,treeId:'id'//树形id字段名称
        ,treeUpId:'parentId'//树形父id字段名称
        ,treeShowName:'orgName'//以树形式显示的字段
	    ,request: {
	        pageName: 'current' 
	        ,limitName: 'size' 
	      }
		,response:{
			countName: 'total',
			statusName:'status',
			statusCode:'200',
			dataName:'result'
		}
	    ,cols: [[ 
	    	/* {type:'checkbox', fixed: 'left'}, */
	    	{field: 'id',style:'display:none;'},
	        {field: 'orgName', title: '机构名称', align:'center'},
	        {field: 'orgCode', title: '机构编码', align:'center'},
	        {field: 'orgTypeName', title: '机构类型', align:'center'},
	        {field: 'gradeName', title: '机构级别', align:'center'},
	        {field: 'principal', title: '负责人', align:'center'},
	        {field: 'telephone', title: '电话', width:180,align:'center'},
	        {field: 'useableName', title: '是否可用',align: 'center'},
	        {fixed: 'right', title: '操作',width:180, align:'center', toolbar: '#barDemo', fixed: 'right'}
	    ]]
	    ,parseData:function (res) {//数据加载后回调
            return res;
        }
        ,onClickRow:function (index, o) {
            console.log(index,o,"单击！");
        }
        ,onDblClickRow:function (index, o) {
            console.log(index,o,"双击");
        }
        ,onCheck:function (obj,checked,isAll) {//复选事件
            console.log(obj,checked,isAll);
        }
        ,onRadio:function (obj) {//单选事件
            console.log(obj);
        },
		done: function(res, curr, count){
	    	$("[data-field='id']").css('display','none');
	    }
	  });
	  
	 
      treeGrid.on('tool(demo)', function(obj){
		    var data = obj.data;
		    if(obj.event === 'detail'){
		    	function view(id, url) {
		    		var  id = obj.data.id;  
		    		var  url = contextPath + "org/form";
		                 url = url + "?id=" + id;
		            $.modal.view("查看部门" , url);
		        }
		        view();
		    } else if(obj.event === 'del'){
		    	function remove(id) {
		    		var  id = obj.data.id; 
	                $.modal.confirm("确定删除该条信息吗？", function () {
	                    var url = contextPath + "org/removeById";
	                    var data = {"id": id};
	                    $.operate.submit(url, "post", "json", data);
	                });
	            }
		    	remove();
		    } else if(obj.event === 'edit'){
		    	function edit(id) {
		    		var  id = obj.data.id;
	               	var url = url = contextPath + "org/form/{id}".replace("{id}", "?id=" + id);;
	                $.modal.open("修改部门", url);
	            }
		    	edit();
		    }
		});
});
</script>

<script type="text/javascript">
//添加信息
function add() {
    var url = contextPath + "org/form";
    $.modal.open("添加部门", url);
};

</script>


</html>
