<!--
  ~ The MIT License (MIT)
  ~
  ~ Copyright (c) 2019 ‭‭‭‭‭‭‭‭‭‭‭‭[smallbun] www.smallbun.org
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy of
  ~ this software and associated documentation files (the "Software"), to deal in
  ~ the Software without restriction, including without limitation the rights to
  ~ use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
  ~ the Software, and to permit persons to whom the Software is furnished to do so,
  ~ subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in all
  ~ copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
  ~ FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
  ~ COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
  ~ IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  ~ CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  -->

<!DOCTYPE HTML>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="/static/common/plugins/layui/css/layui.css" media="all">
    <div th:include="fragments/include  :: header('通知公告')"></div>
    <div th:include="fragments/include :: bootstrap-table-css"></div>
</head>
<body class="list-body">
<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="ibox">
                <!--盒子标题-->
                <div class="ibox-title dashboard-header gray-bg">
                    <h5>通知公告</h5>
                    <div class="pull-right">
                        <!--/*/<th:block sec:authorize="hasAuthority('manage:notify:query')">/*/-->
                       <!--  <button class="btn btn-sm ibtn-primary query-a" title="查询" data-toggle="tooltip"
                                data-placement="left">
                            <i class="fa fa-filter"></i> 查询
                        </button> -->
                        <!--/*/</th:block>/*/-->
                        <!--/*/<th:block sec:authorize="hasAuthority('manage:notify:add')">/*/-->
                        <button type="button" class="btn btn-sm ibtn-info" data-toggle="tooltip" data-placement="left"
                                title="新增"
                                onclick="add()">
                            <i class="fa fa-plus"></i> 新增
                        </button>
                        <!--/*/</th:block>/*/-->
                        <!--/*/<th:block sec:authorize="hasAuthority('manage:notify:edit')">/*/-->
                        <button class="btn btn-sm bg-orange" title="修改" data-toggle="tooltip" data-placement="left"
                                onclick="edit()">
                            <i class="fa fa-pencil"></i> 修改
                        </button>
                        <!--/*/</th:block>/*/-->
                        <!--/*/<th:block sec:authorize="hasAuthority('manage:notify:del')">/*/-->
                        <button class="btn btn-sm bg-maroon" data-toggle="tooltip" data-placement="left" title="删除"
                                onclick="batRemove()"><i
                                class="fa fa-trash-o"></i> 删除
                        </button>
                        <!--/*/</th:block>/*/-->
                       <!--  <div class="btn-group">
                            <button type="button" class="btn ibtn-white btn-sm dropdown-toggle" data-toggle="dropdown"
                                    aria-expanded="false" data-placement="left"
                                    title="更多操作">
                                更多操作<span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:"><i class="glyphicon glyphicon-export"></i> 导出</a></li>
                                <li><a href="javascript:"><i class="glyphicon glyphicon-import"></i> 导入</a></li>
                            </ul>
                        </div> -->
                    </div>
                </div>
                <!--盒子内容-->
                <div class="ibox-content-table">
                    <!--查询框-->
                    <form class="form-inline search search-form" id="search-form" th:action="@{/notify/page}"
                          method="post">
                        <div class="form-group">
                            <span>字典名称：</span>
                            <div class="input-group input-sm width-140">
                                <input id="typeName" name="typeName" type="text"
                                       class="form-control" autocomplete="off">
                            </div>
                        </div>
                        <!-- <div class="form-group">
                            <span>字典值：</span>
                            <div class="input-group input-sm width-140">
                                <input id="typeCode" name="typeCode" type="text"
                                       class="form-control" autocomplete="off">
                            </div>
                        </div> -->
                        <div class="form-group">
                            <a class="btn ibtn-white btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                            <a class="btn ibtn-white btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
                        </div>
                    </form>
                    <table id="table" lay-filter="demo" class="table table-bordered table-striped"
                           data-mobile-responsive="true"  ></table>
                           
                    <script id="barDemo" type="text/html">
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-primary" lay-event="detail">查看</a>
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-normal" lay-event="edit">修改</a>
  						<a class="layui-btn layui-btn-xs layui-btn-radius layui-btn-danger" lay-event="del">删除</a>
					</script> 
                </div>
            </div>
        </div>
    </div>
</section>
</body>
<script src="../static/common/plugins/jquery-3.1.1.min.js"></script>
<div th:include="fragments/include :: include-js"></div>
<div th:include="fragments/include :: bootstrap-table-js"></div>
<script src="../static/common/plugins/layui/layui.js"></script>
<script src="../static/common/js/common.js"></script>

<script type="text/javascript">
function showData(data) {
	var url = contextPath + 'notify/page';
	var json = {};
	$.ajax({
		"url": url,
		"data":json,
		"type": "POST",
		"success": function(data) {
				console.log(data);
			}
	});
}

showData();
</script>
<script type="text/javascript" th:inline="none">
var table;
layui.use('table', function(){
	table = layui.table;
	  
	  table.render({
	    elem: '#table'
	    ,height: 530
	    ,url: contextPath + 'notify/page' 
	    ,method: 'post'
	    ,colFilterRecord: true
	  	,toolbar: '#toolbarDemo'
	    ,page: true
	    ,request: {
	        pageName: 'current' 
	        ,limitName: 'size' 
	      }
		,response:{
			countName: 'total',
			statusName:'status',
			statusCode:'200',
			dataName:'data'
		}
	    ,cols: [[ 
	    	{type:'checkbox', fixed: 'left'},
	    	{field: 'id',style:'display:none;'},
	        {field: 'title', title: '标题', formatter: $.table.view, sortable: true},
            {field: 'notifyGenre', title: '类型', sortable: true},
            {field: 'gmtModified', title: '更新时间', sortable: true},
	        {fixed: 'right', title: '操作',width:180, align:'center', toolbar: '#barDemo', fixed: 'right'}
	    ]],
		done: function(res, curr, count){
	    	$("[data-field='id']").css('display','none');
	    }
	  });
	 
		table.on('tool(demo)', function(obj){
		    var data = obj.data;
		    if(obj.event === 'detail'){
		    	function view(id, url) {
		    		var  id = obj.data.id;  
		    		var  url = contextPath + "notify/form";
		                 url = url + "?id=" + id;
		            $.modal.view("查看角色" , url);
		        }
		        view();
		    } else if(obj.event === 'del'){
		    	function remove(id) {
	                $.modal.confirm("确定删除该条信息吗？", function () {
	                    var url = contextPath + "notify/removeById";
	                    var  id = obj.data.id; 
	                    var data = {"id": id};
	                    $.operate.submit(url, "post", "json", data);
	                });
	            }
		    	remove();
		    } else if(obj.event === 'edit'){
		    	function edit(id) {
		    		var  id = obj.data.id;
	               	var url =contextPath + "notify/form/{id}".replace("{id}", "?id=" + id);
	                $.modal.open("修改角色", url);
	            }
		    	edit();
		    }
		});
});
</script>

<script type="text/javascript">
//添加信息
function add() {
    var url = contextPath + "notify/form";
    $.modal.open("添加角色", url);
};

//修改信息
function edit(){
	var checkStatus = table.checkStatus('table');
	var data = checkStatus.data;
	var id= new Array();
		for(var item in data){
			id.push(data[item].id);
		}
	console.log(id.length+"条数据");
	if  (id.length === 0) {
		$.modal.alertWarning("请至少选择一条记录");
		return;
	}else if (id.length > 1) {
		$.modal.alertWarning("只能选择一条数据");
		return;
	}else {
		url = contextPath + "notify/form/{id}".replace("{id}", "?id=" + id);
	}
	$.modal.open("修改角色", url);
};

// 删除信息
 function remove() {
	var checkStatus = table.checkStatus('table');
	var data = checkStatus.data;
	var id= new Array();
		for(var item in data){
			id.push(data[item].id);
		}
    $.modal.confirm("确定删除该条信息吗？", function () {
        var url = contextPath + "notify/removeById";
        var data = {"id": id};
        $.operate.submit(url, "post", "json", data);
    });
};

//批量删除信息
function batRemove() {
	var checkStatus = table.checkStatus('table');
	var data = checkStatus.data;
	var id= new Array();
		for(var item in data){
			id.push(data[item].id);
		}
	var rows = id;
    if (rows.length === 0) {
    	$.modal.alertWarning("请至少选择一条记录");
        return;
    }
    $.modal.confirm("确认要删除选中的" + rows.length + "条数据吗?", function () {
    	var url = contextPath + "notify/removeByIds";
        var data = {"ids": rows.join()};
        $.operate.submit(url, "post", "json", data);   
	});
};
</script>



</html>