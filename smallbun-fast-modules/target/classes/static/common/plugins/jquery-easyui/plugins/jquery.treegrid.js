(function(k){function l(J){var I=k.data(J,"treegrid");var H=I.options;k(J).datagrid(k.extend({},H,{url:null,data:null,loader:function(){return false},onBeforeLoad:function(){return false},onLoadSuccess:function(){},onResizeColumn:function(N,M){c(J);H.onResizeColumn.call(J,N,M)},onBeforeSortColumn:function(N,M){if(H.onBeforeSortColumn.call(J,N,M)==false){return false}},onSortColumn:function(M,O){H.sortName=M;H.sortOrder=O;if(H.remoteSort){f(J)}else{var N=k(J).treegrid("getData");q(J,null,N)}H.onSortColumn.call(J,M,O)},onClickCell:function(N,M){H.onClickCell.call(J,M,z(J,N))},onDblClickCell:function(M,N){H.onDblClickCell.call(J,N,z(J,M))},onRowContextMenu:function(M,N){H.onContextMenu.call(J,M,z(J,N))}}));var L=k.data(J,"datagrid").options;H.columns=L.columns;H.frozenColumns=L.frozenColumns;I.dc=k.data(J,"datagrid").dc;if(H.pagination){var K=k(J).datagrid("getPager");K.pagination({pageNumber:H.pageNumber,pageSize:H.pageSize,pageList:H.pageList,onSelectPage:function(N,M){H.pageNumber=N;H.pageSize=M;f(J)}});H.pageSize=K.pagination("options").pageSize}}function c(L,J){var I=k.data(L,"datagrid").options;var H=k.data(L,"datagrid").dc;if(!H.body1.is(":empty")&&(!I.nowrap||I.autoRowHeight)){if(J!=undefined){var N=h(L,J);for(var M=0;M<N.length;M++){K(N[M][I.idField])}}}k(L).datagrid("fixRowHeight",J);function K(Q){var O=I.finder.getTr(L,Q,"body",1);var R=I.finder.getTr(L,Q,"body",2);O.css("height","");R.css("height","");var P=Math.max(O.height(),R.height());O.css("height",P);R.css("height",P)}}function b(J){var I=k.data(J,"datagrid").dc;var H=k.data(J,"treegrid").options;if(!H.rownumbers){return}I.body1.find("div.datagrid-cell-rownumber").each(function(K){k(this).html(K+1)})}function u(H){return function(K){k.fn.datagrid.defaults.rowEvents[H?"mouseover":"mouseout"](K);var J=k(K.target);var I=H?"addClass":"removeClass";if(J.hasClass("tree-hit")){J.hasClass("tree-expanded")?J[I]("tree-expanded-hover"):J[I]("tree-collapsed-hover")}}}function s(K){var L=k(K.target);var M=L.closest("tr.datagrid-row");if(!M.length||!M.parent().length){return}var S=M.attr("node-id");var R=p(M);if(L.hasClass("tree-hit")){o(R,S)}else{if(L.hasClass("tree-checkbox")){n(R,S)}else{var H=k(R).datagrid("options");if(!L.parent().hasClass("datagrid-cell-check")&&!H.singleSelect&&K.shiftKey){var V=k(R).treegrid("getChildren");var T=k.easyui.indexOfArray(V,H.idField,H.lastSelectedIndex);var Q=k.easyui.indexOfArray(V,H.idField,S);var P=Math.min(Math.max(T,0),Q);var O=Math.max(T,Q);var U=V[Q];var I=L.closest("td[field]",M);if(I.length){var N=I.attr("field");H.onClickCell.call(R,S,N,U[N])}k(R).treegrid("clearSelections");for(var J=P;J<=O;J++){k(R).treegrid("selectRow",V[J][H.idField])}H.onClickRow.call(R,U)}else{k.fn.datagrid.defaults.rowEvents.click(K)}}}}function p(H){return k(H).closest("div.datagrid-view").children(".datagrid-f")[0]}function n(O,N,M,L){var J=k.data(O,"treegrid");var I=J.checkedRows;var H=J.options;if(!H.checkbox){return}var Q=z(O,N);if(!Q.checkState){return}var K=H.finder.getTr(O,N);var P=K.find(".tree-checkbox");if(M==undefined){if(P.hasClass("tree-checkbox1")){M=false}else{if(P.hasClass("tree-checkbox0")){M=true}else{if(Q._checked==undefined){Q._checked=P.hasClass("tree-checkbox1")}M=!Q._checked}}}Q._checked=M;if(M){if(P.hasClass("tree-checkbox1")){return}}else{if(P.hasClass("tree-checkbox0")){return}}if(!L){if(H.onBeforeCheckNode.call(O,Q,M)==false){return}}if(H.cascadeCheck){x(O,Q,M);w(O,Q)}else{G(O,Q,M?"1":"0")}if(!L){H.onCheckNode.call(O,Q,M)}}function G(N,O,M){var K=k.data(N,"treegrid");var J=K.checkedRows;var I=K.options;if(!O.checkState||M==undefined){return}var L=I.finder.getTr(N,O[I.idField]);var H=L.find(".tree-checkbox");if(!H.length){return}O.checkState=["unchecked","checked","indeterminate"][M];O.checked=(O.checkState=="checked");H.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2");H.addClass("tree-checkbox"+M);if(M==0){k.easyui.removeArrayItem(J,I.idField,O[I.idField])}else{k.easyui.addArrayItem(J,I.idField,O)}}function x(J,K,I){var H=I?1:0;G(J,K,H);k.easyui.forEach(K.children||[],true,function(L){G(J,L,H)})}function w(J,K){var I=k.data(J,"treegrid").options;var H=e(J,K[I.idField]);if(H){G(J,H,d(H));w(J,H)}}function d(L){var H=0;var J=0;var I=0;k.easyui.forEach(L.children||[],false,function(M){if(M.checkState){H++;if(M.checkState=="checked"){I++}else{if(M.checkState=="unchecked"){J++}}}});if(H==0){return undefined}var K=0;if(J==H){K=0}else{if(I==H){K=1}else{K=2}}return K}function a(H,N){var M=k.data(H,"treegrid").options;if(!M.checkbox){return}var L=z(H,N);var J=M.finder.getTr(H,N);var I=J.find(".tree-checkbox");if(M.view.hasCheckbox(H,L)){if(!I.length){L.checkState=L.checkState||"unchecked";k('<span class="tree-checkbox"></span>').insertBefore(J.find(".tree-title"))}if(L.checkState=="checked"){n(H,N,true,true)}else{if(L.checkState=="unchecked"){n(H,N,false,true)}else{var K=d(L);if(K===0){n(H,N,false,true)}else{if(K===1){n(H,N,true,true)}}}}}else{I.remove();L.checkState=undefined;L.checked=undefined;w(H,L)}}function g(M,N){var L=k.data(M,"treegrid").options;var H=L.finder.getTr(M,N,"body",1);var O=L.finder.getTr(M,N,"body",2);var K=k(M).datagrid("getColumnFields",true).length+(L.rownumbers?1:0);var J=k(M).datagrid("getColumnFields",false).length;I(H,K);I(O,J);function I(Q,P){k('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+P+'"><div></div></td></tr>').insertAfter(Q)}}function q(O,M,J,V,U){var S=k.data(O,"treegrid");var P=S.options;var R=S.dc;J=P.loadFilter.call(O,J,M);var N=z(O,M);if(N){var L=P.finder.getTr(O,M,"body",1);var K=P.finder.getTr(O,M,"body",2);var T=L.next("tr.treegrid-tr-tree").children("td").children("div");var Q=K.next("tr.treegrid-tr-tree").children("td").children("div");if(!V){N.children=[]}}else{var T=R.body1;var Q=R.body2;if(!V){S.data=[]}}if(!V){T.empty();Q.empty()}if(P.view.onBeforeRender){P.view.onBeforeRender.call(P.view,O,M,J)}P.view.render.call(P.view,O,T,true);P.view.render.call(P.view,O,Q,false);if(P.showFooter){P.view.renderFooter.call(P.view,O,R.footer1,true);P.view.renderFooter.call(P.view,O,R.footer2,false)}if(P.view.onAfterRender){P.view.onAfterRender.call(P.view,O)}if(!M&&P.pagination){var I=k.data(O,"treegrid").total;var H=k(O).datagrid("getPager");if(H.pagination("options").total!=I){H.pagination({total:I})}}c(O);b(O);k(O).treegrid("showLines");k(O).treegrid("setSelectionState");k(O).treegrid("autoSizeColumn");if(!U){P.onLoadSuccess.call(O,N,J)}}function f(P,O,M,K,J){var I=k.data(P,"treegrid").options;var H=k(P).datagrid("getPanel").find("div.datagrid-body");if(O==undefined&&I.queryParams){I.queryParams.id=undefined}if(M){I.queryParams=M}var Q=k.extend({},I.queryParams);if(I.pagination){k.extend(Q,{page:I.pageNumber,rows:I.pageSize})}if(I.sortName){k.extend(Q,{sort:I.sortName,order:I.sortOrder})}var R=z(P,O);if(I.onBeforeLoad.call(P,R,Q)==false){return}var N=H.find('tr[node-id="'+O+'"] span.tree-folder');N.addClass("tree-loading");k(P).treegrid("loading");var L=I.loader.call(P,Q,function(S){N.removeClass("tree-loading");k(P).treegrid("loaded");q(P,O,S,K);if(J){J()}},function(){N.removeClass("tree-loading");k(P).treegrid("loaded");I.onLoadError.apply(P,arguments);if(J){J()}});if(L==false){N.removeClass("tree-loading");k(P).treegrid("loaded")}}function B(I){var H=j(I);return H.length?H[0]:null}function j(H){return k.data(H,"treegrid").data}function e(I,H){var J=z(I,H);if(J._parentId){return z(I,J._parentId)}else{return null}}function h(L,K){var J=k.data(L,"treegrid").data;if(K){var I=z(L,K);J=I?(I.children||[]):[]}var H=[];k.easyui.forEach(J,true,function(M){H.push(M)});return H}function i(K,J){var I=k.data(K,"treegrid").options;var L=I.finder.getTr(K,J);var H=L.children('td[field="'+I.treeField+'"]');return H.find("span.tree-indent,span.tree-hit").length}function z(J,I){var H=k.data(J,"treegrid");var L=H.options;var K=null;k.easyui.forEach(H.data,true,function(M){if(M[L.idField]==I){K=M;return false}});return K}function r(J,I){var H=k.data(J,"treegrid").options;var M=z(J,I);var L=H.finder.getTr(J,I);var K=L.find("span.tree-hit");if(K.length==0){return}if(K.hasClass("tree-collapsed")){return}if(H.onBeforeCollapse.call(J,M)==false){return}K.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");K.next().removeClass("tree-folder-open");M.state="closed";L=L.next("tr.treegrid-tr-tree");var N=L.children("td").children("div");if(H.animate){N.slideUp("normal",function(){k(J).treegrid("autoSizeColumn");c(J,I);H.onCollapse.call(J,M)})}else{N.hide();k(J).treegrid("autoSizeColumn");c(J,I);H.onCollapse.call(J,M)}}function v(P,O){var N=k.data(P,"treegrid").options;var J=N.finder.getTr(P,O);var H=J.find("span.tree-hit");var Q=z(P,O);if(H.length==0){return}if(H.hasClass("tree-expanded")){return}if(N.onBeforeExpand.call(P,Q)==false){return}H.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded");H.next().addClass("tree-folder-open");var M=J.next("tr.treegrid-tr-tree");if(M.length){var I=M.children("td").children("div");K(I)}else{g(P,Q[N.idField]);var M=J.next("tr.treegrid-tr-tree");var I=M.children("td").children("div");I.hide();var L=k.extend({},N.queryParams||{});L.id=Q[N.idField];f(P,Q[N.idField],L,true,function(){if(I.is(":empty")){M.remove()}else{K(I)}})}function K(R){Q.state="open";if(N.animate){R.slideDown("normal",function(){k(P).treegrid("autoSizeColumn");c(P,O);N.onExpand.call(P,Q)})}else{R.show();k(P).treegrid("autoSizeColumn");c(P,O);N.onExpand.call(P,Q)}}}function o(J,I){var H=k.data(J,"treegrid").options;var L=H.finder.getTr(J,I);var K=L.find("span.tree-hit");if(K.hasClass("tree-expanded")){r(J,I)}else{v(J,I)}}function F(L,K){var J=k.data(L,"treegrid").options;var I=h(L,K);if(K){I.unshift(z(L,K))}for(var H=0;H<I.length;H++){r(L,I[H][J.idField])}}function y(L,K){var J=k.data(L,"treegrid").options;var I=h(L,K);if(K){I.unshift(z(L,K))}for(var H=0;H<I.length;H++){v(L,I[H][J.idField])}}function D(J,L){var K=k.data(J,"treegrid").options;var I=[];var M=e(J,L);while(M){var N=M[K.idField];I.unshift(N);M=e(J,N)}for(var H=0;H<I.length;H++){v(J,I[H])}}function t(L,K){var J=k.data(L,"treegrid");var I=J.options;if(K.parent){var N=I.finder.getTr(L,K.parent);if(N.next("tr.treegrid-tr-tree").length==0){g(L,K.parent)}var H=N.children('td[field="'+I.treeField+'"]').children("div.datagrid-cell");var O=H.children("span.tree-icon");if(O.hasClass("tree-file")){O.removeClass("tree-file").addClass("tree-folder tree-folder-open");var M=k('<span class="tree-hit tree-expanded"></span>').insertBefore(O);if(M.prev().length){M.prev().remove()}}}q(L,K.parent,K.data,J.data.length>0,true)}function m(P,O){var H=O.before||O.after;var N=k.data(P,"treegrid").options;var M=e(P,H);t(P,{parent:(M?M[N.idField]:null),data:[O.data]});var L=M?M.children:k(P).treegrid("getRoots");for(var I=0;I<L.length;I++){if(L[I][N.idField]==H){var K=L[L.length-1];L.splice(O.before?I:(I+1),0,K);L.splice(L.length-1,1);break}}J(true);J(false);b(P);k(P).treegrid("showLines");function J(V){var U=V?1:2;var T=N.finder.getTr(P,O.data[N.idField],"body",U);var S=T.closest("table.datagrid-btable");T=T.parent().children();var R=N.finder.getTr(P,H,"body",U);if(O.before){T.insertBefore(R)}else{var Q=R.next("tr.treegrid-tr-tree");T.insertAfter(Q.length?Q:R)}S.remove()}}function A(K,J){var I=k.data(K,"treegrid");var H=I.options;var L=e(K,J);k(K).datagrid("deleteRow",J);k.easyui.removeArrayItem(I.checkedRows,H.idField,J);b(K);if(L){a(K,L[H.idField])}I.total-=1;k(K).datagrid("getPager").pagination("refresh",{total:I.total});k(K).treegrid("showLines")}function E(K){var L=k(K);var J=L.treegrid("options");if(J.lines){L.treegrid("getPanel").addClass("tree-lines")}else{L.treegrid("getPanel").removeClass("tree-lines");return}L.treegrid("getPanel").find("span.tree-indent").removeClass("tree-line tree-join tree-joinbottom");L.treegrid("getPanel").find("div.datagrid-cell").removeClass("tree-node-last tree-root-first tree-root-one");var I=L.treegrid("getRoots");if(I.length>1){M(I[0]).addClass("tree-root-first")}else{if(I.length==1){M(I[0]).addClass("tree-root-one")}}H(I);N(I);function H(P){k.map(P,function(R){if(R.children&&R.children.length){H(R.children)}else{var Q=M(R);Q.find(".tree-icon").prev().addClass("tree-join")}});if(P.length){var O=M(P[P.length-1]);O.addClass("tree-node-last");O.find(".tree-join").removeClass("tree-join").addClass("tree-joinbottom")}}function N(R){k.map(R,function(U){if(U.children&&U.children.length){N(U.children)}});for(var Q=0;Q<R.length-1;Q++){var P=R[Q];var O=L.treegrid("getLevel",P[J.idField]);var S=J.finder.getTr(K,P[J.idField]);var T=S.next().find('tr.datagrid-row td[field="'+J.treeField+'"] div.datagrid-cell');T.find("span:eq("+(O-1)+")").addClass("tree-line")}}function M(P){var Q=J.finder.getTr(K,P[J.idField]);var O=Q.find('td[field="'+J.treeField+'"] div.datagrid-cell');return O}}k.fn.treegrid=function(J,I){if(typeof J=="string"){var H=k.fn.treegrid.methods[J];if(H){return H(this,I)}else{return this.datagrid(J,I)}}J=J||{};return this.each(function(){var K=k.data(this,"treegrid");if(K){k.extend(K.options,J)}else{K=k.data(this,"treegrid",{options:k.extend({},k.fn.treegrid.defaults,k.fn.treegrid.parseOptions(this),J),data:[],checkedRows:[],tmpIds:[]})}l(this);if(K.options.data){k(this).treegrid("loadData",K.options.data)}f(this)})};k.fn.treegrid.methods={options:function(H){return k.data(H[0],"treegrid").options},resize:function(I,H){return I.each(function(){k(this).datagrid("resize",H)})},fixRowHeight:function(I,H){return I.each(function(){c(this,H)})},loadData:function(I,H){return I.each(function(){q(this,H.parent,H)})},load:function(I,H){return I.each(function(){k(this).treegrid("options").pageNumber=1;k(this).treegrid("getPager").pagination({pageNumber:1});k(this).treegrid("reload",H)})},reload:function(I,H){return I.each(function(){var M=k(this).treegrid("options");var L={};if(typeof H=="object"){L=H}else{L=k.extend({},M.queryParams);L.id=H}if(L.id){var K=k(this).treegrid("find",L.id);if(K.children){K.children.splice(0,K.children.length)}M.queryParams=L;var J=M.finder.getTr(this,L.id);J.next("tr.treegrid-tr-tree").remove();J.find("span.tree-hit").removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed");v(this,L.id)}else{f(this,null,L)}})},reloadFooter:function(I,H){return I.each(function(){var K=k.data(this,"treegrid").options;var J=k.data(this,"datagrid").dc;if(H){k.data(this,"treegrid").footer=H}if(K.showFooter){K.view.renderFooter.call(K.view,this,J.footer1,true);K.view.renderFooter.call(K.view,this,J.footer2,false);if(K.view.onAfterRender){K.view.onAfterRender.call(K.view,this)}k(this).treegrid("fixRowHeight")}})},getData:function(H){return k.data(H[0],"treegrid").data},getFooterRows:function(H){return k.data(H[0],"treegrid").footer},getRoot:function(H){return B(H[0])},getRoots:function(H){return j(H[0])},getParent:function(I,H){return e(I[0],H)},getChildren:function(I,H){return h(I[0],H)},getLevel:function(I,H){return i(I[0],H)},find:function(I,H){return z(I[0],H)},isLeaf:function(L,K){var H=k.data(L[0],"treegrid").options;var J=H.finder.getTr(L[0],K);var I=J.find("span.tree-hit");return I.length==0},select:function(I,H){return I.each(function(){k(this).datagrid("selectRow",H)})},unselect:function(I,H){return I.each(function(){k(this).datagrid("unselectRow",H)})},collapse:function(I,H){return I.each(function(){r(this,H)})},expand:function(I,H){return I.each(function(){v(this,H)})},toggle:function(I,H){return I.each(function(){o(this,H)})},collapseAll:function(I,H){return I.each(function(){F(this,H)})},expandAll:function(I,H){return I.each(function(){y(this,H)})},expandTo:function(I,H){return I.each(function(){D(this,H)})},append:function(I,H){return I.each(function(){t(this,H)})},insert:function(I,H){return I.each(function(){m(this,H)})},remove:function(I,H){return I.each(function(){A(this,H)})},pop:function(J,I){var H=J.treegrid("find",I);J.treegrid("remove",I);return H},refresh:function(I,H){return I.each(function(){var J=k.data(this,"treegrid").options;J.view.refreshRow.call(J.view,this,H)})},update:function(I,H){return I.each(function(){var J=k.data(this,"treegrid").options;var K=H.row;J.view.updateRow.call(J.view,this,H.id,K);if(K.checked!=undefined){K=z(this,H.id);k.extend(K,{checkState:K.checked?"checked":(K.checked===false?"unchecked":undefined)});a(this,H.id)}})},beginEdit:function(I,H){return I.each(function(){k(this).datagrid("beginEdit",H);k(this).treegrid("fixRowHeight",H)})},endEdit:function(I,H){return I.each(function(){k(this).datagrid("endEdit",H)})},cancelEdit:function(I,H){return I.each(function(){k(this).datagrid("cancelEdit",H)})},showLines:function(H){return H.each(function(){E(this)})},setSelectionState:function(H){return H.each(function(){k(this).datagrid("setSelectionState");var I=k(this).data("treegrid");for(var J=0;J<I.tmpIds.length;J++){n(this,I.tmpIds[J],true,true)}I.tmpIds=[]})},getCheckedNodes:function(J,I){I=I||"checked";var H=[];k.easyui.forEach(J.data("treegrid").checkedRows,false,function(K){if(K.checkState==I){H.push(K)}});return H},checkNode:function(I,H){return I.each(function(){n(this,H,true)})},uncheckNode:function(I,H){return I.each(function(){n(this,H,false)})},clearChecked:function(H){return H.each(function(){var J=this;var I=k(J).treegrid("options");k(J).datagrid("clearChecked");k.map(k(J).treegrid("getCheckedNodes"),function(K){n(J,K[I.idField],false,true)})})}};k.fn.treegrid.parseOptions=function(H){return k.extend({},k.fn.datagrid.parseOptions(H),k.parser.parseOptions(H,["treeField",{checkbox:"boolean",cascadeCheck:"boolean",onlyLeafCheck:"boolean"},{animate:"boolean"}]))};var C=k.extend({},k.fn.datagrid.defaults.view,{render:function(L,K,I){var H=k.data(L,"treegrid").options;var P=k(L).datagrid("getColumnFields",I);var O=k.data(L,"datagrid").rowIdPrefix;if(I){if(!(H.rownumbers||(H.frozenColumns&&H.frozenColumns.length))){return}}var N=this;if(this.treeNodes&&this.treeNodes.length){var M=J.call(this,I,this.treeLevel,this.treeNodes);k(K).append(M.join(""))}function J(S,R,Q){var ae=k(L).treegrid("getParent",Q[0][H.idField]);var ac=(ae?ae.children.length:k(L).treegrid("getRoots").length)-Q.length;var aa=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var T=0;T<Q.length;T++){var ad=Q[T];if(ad.state!="open"&&ad.state!="closed"){ad.state="open"}var U=H.rowStyler?H.rowStyler.call(L,ad):"";var V=this.getStyleValue(U);var ab='class="datagrid-row '+(ac++%2&&H.striped?"datagrid-row-alt ":" ")+V.c+'"';var Z=V.s?'style="'+V.s+'"':"";var X=O+"-"+(S?1:2)+"-"+ad[H.idField];aa.push('<tr id="'+X+'" node-id="'+ad[H.idField]+'" '+ab+" "+Z+">");aa=aa.concat(N.renderRow.call(N,L,P,S,R,ad));aa.push("</tr>");if(ad.children&&ad.children.length){var W=J.call(this,S,R+1,ad.children);var Y=ad.state=="closed"?"none":"block";aa.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(P.length+(H.rownumbers?1:0))+'><div style="display:'+Y+'">');aa=aa.concat(W);aa.push("</div></td></tr>")}}aa.push("</tbody></table>");return aa}},renderFooter:function(K,J,I){var O=k.data(K,"treegrid").options;var N=k.data(K,"treegrid").footer||[];var M=k(K).datagrid("getColumnFields",I);var L=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var H=0;H<N.length;H++){var P=N[H];P[O.idField]=P[O.idField]||("foot-row-id"+H);L.push('<tr class="datagrid-row" node-id="'+P[O.idField]+'">');L.push(this.renderRow.call(this,K,M,I,0,P));L.push("</tr>")}L.push("</tbody></table>");k(J).html(L.join(""))},renderRow:function(K,J,U,T,N){var R=k.data(K,"treegrid");var S=R.options;var V=[];if(U&&S.rownumbers){V.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>')}for(var Y=0;Y<J.length;Y++){var Q=J[Y];var M=k(K).datagrid("getColumnOption",Q);if(M){var O=M.styler?(M.styler(N[Q],N)||""):"";var L=this.getStyleValue(O);var I=L.c?'class="'+L.c+'"':"";var P=M.hidden?'style="display:none;'+L.s+'"':(L.s?'style="'+L.s+'"':"");V.push('<td field="'+Q+'" '+I+" "+P+">");var P="";if(!M.checkbox){if(M.align){P+="text-align:"+M.align+";"}if(!S.nowrap){P+="white-space:normal;height:auto;"}else{if(S.autoRowHeight){P+="height:auto;"}}}V.push('<div style="'+P+'" ');if(M.checkbox){V.push('class="datagrid-cell-check ')}else{V.push('class="datagrid-cell '+M.cellClass)}if(Q==S.treeField){V.push(" tree-node")}V.push('">');if(M.checkbox){if(N.checked){V.push('<input type="checkbox" checked="checked"')}else{V.push('<input type="checkbox"')}V.push(' name="'+Q+'" value="'+(N[Q]!=undefined?N[Q]:"")+'">')}else{var aa=null;if(M.formatter){aa=M.formatter(N[Q],N)}else{aa=N[Q]}if(Q==S.treeField){for(var W=0;W<T;W++){V.push('<span class="tree-indent"></span>')}if(N.state=="closed"){V.push('<span class="tree-hit tree-collapsed"></span>');V.push('<span class="tree-icon tree-folder '+(N.iconCls?N.iconCls:"")+'"></span>')}else{if(N.children&&N.children.length){V.push('<span class="tree-hit tree-expanded"></span>');V.push('<span class="tree-icon tree-folder tree-folder-open '+(N.iconCls?N.iconCls:"")+'"></span>')}else{V.push('<span class="tree-indent"></span>');V.push('<span class="tree-icon tree-file '+(N.iconCls?N.iconCls:"")+'"></span>')}}if(this.hasCheckbox(K,N)){var X=0;var H=k.easyui.getArrayItem(R.checkedRows,S.idField,N[S.idField]);if(H){X=H.checkState=="checked"?1:2;N.checkState=H.checkState;N.checked=H.checked;k.easyui.addArrayItem(R.checkedRows,S.idField,N)}else{var Z=k.easyui.getArrayItem(R.checkedRows,S.idField,N._parentId);if(Z&&Z.checkState=="checked"&&S.cascadeCheck){X=1;N.checked=true;k.easyui.addArrayItem(R.checkedRows,S.idField,N)}else{if(N.checked){k.easyui.addArrayItem(R.tmpIds,N[S.idField])}}N.checkState=X?"checked":"unchecked"}V.push('<span class="tree-checkbox tree-checkbox'+X+'"></span>')}else{N.checkState=undefined;N.checked=undefined}V.push('<span class="tree-title">'+aa+"</span>")}else{V.push(aa)}}V.push("</div>");V.push("</td>")}}return V.join("")},hasCheckbox:function(H,J){var I=k.data(H,"treegrid").options;if(I.checkbox){if(k.isFunction(I.checkbox)){if(I.checkbox.call(H,J)){return true}else{return false}}else{if(I.onlyLeafCheck){if(J.state=="open"&&!(J.children&&J.children.length)){return true}}else{return true}}}return false},refreshRow:function(H,I){this.updateRow.call(this,H,I,{})},updateRow:function(L,I,Q){var H=k.data(L,"treegrid").options;var K=k(L).treegrid("find",I);k.extend(K,Q);var J=k(L).treegrid("getLevel",I)-1;var P=H.rowStyler?H.rowStyler.call(L,K):"";var O=k.data(L,"datagrid").rowIdPrefix;var N=K[H.idField];function M(V){var T=k(L).treegrid("getColumnFields",V);var S=H.finder.getTr(L,I,"body",(V?1:2));var U=S.find("div.datagrid-cell-rownumber").html();var R=S.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");S.html(this.renderRow(L,T,V,J,K));S.attr("style",P||"");S.find("div.datagrid-cell-rownumber").html(U);if(R){S.find("div.datagrid-cell-check input[type=checkbox]")._propAttr("checked",true)}if(N!=I){S.attr("id",O+"-"+(V?1:2)+"-"+N);S.attr("node-id",N)}}M.call(this,true);M.call(this,false);k(L).treegrid("fixRowHeight",I)},deleteRow:function(L,N){var K=k.data(L,"treegrid").options;var M=K.finder.getTr(L,N);M.next("tr.treegrid-tr-tree").remove();M.remove();var J=I(N);if(J){if(J.children.length==0){M=K.finder.getTr(L,J[K.idField]);M.next("tr.treegrid-tr-tree").remove();var H=M.children('td[field="'+K.treeField+'"]').children("div.datagrid-cell");H.find(".tree-icon").removeClass("tree-folder").addClass("tree-file");H.find(".tree-hit").remove();k('<span class="tree-indent"></span>').prependTo(H)}}this.setEmptyMsg(L);function I(R){var Q;var P=k(L).treegrid("getParent",R);if(P){Q=P.children}else{Q=k(L).treegrid("getData")}for(var O=0;O<Q.length;O++){if(Q[O][K.idField]==R){Q.splice(O,1);break}}return P}},onBeforeRender:function(K,J,N){if(k.isArray(J)){N={total:J.length,rows:J};J=null}if(!N){return false}var I=k.data(K,"treegrid");var M=I.options;if(N.length==undefined){if(N.footer){I.footer=N.footer}if(N.total){I.total=N.total}N=this.transfer(K,J,N.rows)}else{function H(R,O){for(var P=0;P<R.length;P++){var Q=R[P];Q._parentId=O;if(Q.children&&Q.children.length){H(Q.children,Q[M.idField])}}}H(N,J)}this.sort(K,N);this.treeNodes=N;this.treeLevel=k(K).treegrid("getLevel",J);var L=z(K,J);if(L){if(L.children){L.children=L.children.concat(N)}else{L.children=N}}else{I.data=I.data.concat(N)}},sort:function(J,L){var K=k.data(J,"treegrid").options;if(!K.remoteSort&&K.sortName){var I=K.sortName.split(",");var H=K.sortOrder.split(",");M(L)}function M(O){O.sort(function(R,Q){var U=0;for(var T=0;T<I.length;T++){var X=I[T];var V=H[T];var S=k(J).treegrid("getColumnOption",X);var W=S.sorter||function(Z,Y){return Z==Y?0:(Z>Y?1:-1)};U=W(R[X],Q[X])*(V=="asc"?1:-1);if(U!=0){return U}}return U});for(var N=0;N<O.length;N++){var P=O[N].children;if(P&&P.length){M(P)}}}},transfer:function(N,M,P){var H=k.data(N,"treegrid").options;var Q=k.extend([],P);var K=J(M,Q);var O=k.extend([],K);while(O.length){var L=O.shift();var I=J(L[H.idField],Q);if(I.length){if(L.children){L.children=L.children.concat(I)}else{L.children=I}O=O.concat(I)}}return K;function J(T,U){var R=[];for(var S=0;S<U.length;S++){var V=U[S];if(V._parentId==T){R.push(V);U.splice(S,1);S--}}return R}}});k.fn.treegrid.defaults=k.extend({},k.fn.datagrid.defaults,{treeField:null,checkbox:false,cascadeCheck:true,onlyLeafCheck:false,lines:false,animate:false,singleSelect:true,view:C,rowEvents:k.extend({},k.fn.datagrid.defaults.rowEvents,{mouseover:u(true),mouseout:u(false),click:s}),loader:function(J,I,H){var K=k(this).treegrid("options");if(!K.url){return false}k.ajax({type:K.method,url:K.url,data:J,dataType:"json",success:function(L){I(L)},error:function(){H.apply(this,arguments)}})},loadFilter:function(I,H){return I},finder:{getTr:function(K,I,O,J){O=O||"body";J=J||0;var P=k.data(K,"datagrid").dc;if(J==0){var H=k.data(K,"treegrid").options;var M=H.finder.getTr(K,I,O,1);var L=H.finder.getTr(K,I,O,2);return M.add(L)}else{if(O=="body"){var N=k("#"+k.data(K,"datagrid").rowIdPrefix+"-"+J+"-"+I);if(!N.length){N=(J==1?P.body1:P.body2).find('tr[node-id="'+I+'"]')}return N}else{if(O=="footer"){return(J==1?P.footer1:P.footer2).find('tr[node-id="'+I+'"]')}else{if(O=="selected"){return(J==1?P.body1:P.body2).find("tr.datagrid-row-selected")}else{if(O=="highlight"){return(J==1?P.body1:P.body2).find("tr.datagrid-row-over")}else{if(O=="checked"){return(J==1?P.body1:P.body2).find("tr.datagrid-row-checked")}else{if(O=="last"){return(J==1?P.body1:P.body2).find("tr:last[node-id]")}else{if(O=="allbody"){return(J==1?P.body1:P.body2).find("tr[node-id]")}else{if(O=="allfooter"){return(J==1?P.footer1:P.footer2).find("tr[node-id]")}}}}}}}}}},getRow:function(H,I){var J=(typeof I=="object")?I.attr("node-id"):I;return k(H).treegrid("find",J)},getRows:function(H){return k(H).treegrid("getChildren")}},onBeforeLoad:function(I,H){},onLoadSuccess:function(I,H){},onLoadError:function(){},onBeforeCollapse:function(H){},onCollapse:function(H){},onBeforeExpand:function(H){},onExpand:function(H){},onClickRow:function(H){},onDblClickRow:function(H){},onClickCell:function(H,I){},onDblClickCell:function(H,I){},onContextMenu:function(H,I){},onBeforeEdit:function(H){},onAfterEdit:function(H,I){},onCancelEdit:function(H){},onBeforeCheckNode:function(I,H){},onCheckNode:function(I,H){}})})(jQuery);