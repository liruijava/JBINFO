(function(e){function f(j,i){var h=e.data(j,"window");if(i){if(i.left!=null){h.options.left=i.left}if(i.top!=null){h.options.top=i.top}}e(j).panel("move",h.options);if(h.shadow){h.shadow.css({left:h.options.left,top:h.options.top})}}function d(l,k){var j=e.data(l,"window").options;var i=e(l).window("panel");var h=i._outerWidth();if(j.inline){var m=i.parent();j.left=Math.ceil((m.width()-h)/2+m.scrollLeft())}else{j.left=Math.ceil((e(window)._outerWidth()-h)/2+e(document).scrollLeft())}if(k){f(l)}}function c(k,j){var h=e.data(k,"window").options;var i=e(k).window("panel");var m=i._outerHeight();if(h.inline){var l=i.parent();h.top=Math.ceil((l.height()-m)/2+l.scrollTop())}else{h.top=Math.ceil((e(window)._outerHeight()-m)/2+e(document).scrollTop())}if(j){f(k)}}function g(l){var j=e.data(l,"window");var i=j.options;var k=e(l).panel(e.extend({},j.options,{border:false,doSize:true,closed:true,cls:"window "+(!i.border?"window-thinborder window-noborder ":(i.border=="thin"?"window-thinborder ":""))+(i.cls||""),headerCls:"window-header "+(i.headerCls||""),bodyCls:"window-body "+(i.noheader?"window-body-noheader ":" ")+(i.bodyCls||""),onBeforeDestroy:function(){if(i.onBeforeDestroy.call(l)==false){return false}if(j.shadow){j.shadow.remove()}if(j.mask){j.mask.remove()}},onClose:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}i.onClose.call(l)},onOpen:function(){if(j.mask){j.mask.css(e.extend({display:"block",zIndex:e.fn.window.defaults.zIndex++},e.fn.window.getMaskSize(l)))}if(j.shadow){j.shadow.css({display:"block",zIndex:e.fn.window.defaults.zIndex++,left:i.left,top:i.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}j.window.css("z-index",e.fn.window.defaults.zIndex++);i.onOpen.call(l)},onResize:function(o,n){var m=e(this).panel("options");e.extend(i,{width:m.width,height:m.height,left:m.left,top:m.top});if(j.shadow){j.shadow.css({left:i.left,top:i.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}i.onResize.call(l,o,n)},onMinimize:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}j.options.onMinimize.call(l)},onBeforeCollapse:function(){if(i.onBeforeCollapse.call(l)==false){return false}if(j.shadow){j.shadow.hide()}},onExpand:function(){if(j.shadow){j.shadow.show()}i.onExpand.call(l)}}));j.window=k.panel("panel");if(j.mask){j.mask.remove()}if(i.modal){j.mask=e('<div class="window-mask" style="display:none"></div>').insertAfter(j.window)}if(j.shadow){j.shadow.remove()}if(i.shadow){j.shadow=e('<div class="window-shadow" style="display:none"></div>').insertAfter(j.window)}var h=i.closed;if(i.left==null){d(l)}if(i.top==null){c(l)}f(l);if(!h){k.window("open")}}function b(n,p,m,l){var k=this;var j=e.data(k,"window");var i=j.options;if(!i.constrain){return{}}if(e.isFunction(i.constrain)){return i.constrain.call(k,n,p,m,l)}var o=e(k).window("window");var h=i.inline?o.parent():e(window);if(n<0){n=0}if(p<h.scrollTop()){p=h.scrollTop()}if(n+m>h.width()){if(m==o.outerWidth()){n=h.width()-m}else{m=h.width()-n}}if(p-h.scrollTop()+l>h.height()){if(l==o.outerHeight()){p=h.height()-l+h.scrollTop()}else{l=h.height()-p+h.scrollTop()}}return{left:n,top:p,width:m,height:l}}function a(l){var k=e.data(l,"window");k.window.draggable({handle:">div.panel-header>div.panel-title",disabled:k.options.draggable==false,onBeforeDrag:function(m){if(k.mask){k.mask.css("z-index",e.fn.window.defaults.zIndex++)}if(k.shadow){k.shadow.css("z-index",e.fn.window.defaults.zIndex++)}k.window.css("z-index",e.fn.window.defaults.zIndex++)},onStartDrag:function(m){j(m)},onDrag:function(m){i(m);return false},onStopDrag:function(m){h(m,"move")}});k.window.resizable({disabled:k.options.resizable==false,onStartResize:function(m){j(m)},onResize:function(m){i(m);return false},onStopResize:function(m){h(m,"resize")}});function j(m){if(k.pmask){k.pmask.remove()}k.pmask=e('<div class="window-proxy-mask"></div>').insertAfter(k.window);k.pmask.css({display:"none",zIndex:e.fn.window.defaults.zIndex++,left:m.data.left,top:m.data.top,width:k.window._outerWidth(),height:k.window._outerHeight()});if(k.proxy){k.proxy.remove()}k.proxy=e('<div class="window-proxy"></div>').insertAfter(k.window);k.proxy.css({display:"none",zIndex:e.fn.window.defaults.zIndex++,left:m.data.left,top:m.data.top});k.proxy._outerWidth(m.data.width)._outerHeight(m.data.height);k.proxy.hide();setTimeout(function(){if(k.pmask){k.pmask.show()}if(k.proxy){k.proxy.show()}},500)}function i(m){e.extend(m.data,b.call(l,m.data.left,m.data.top,m.data.width,m.data.height));k.pmask.show();k.proxy.css({display:"block",left:m.data.left,top:m.data.top});k.proxy._outerWidth(m.data.width);k.proxy._outerHeight(m.data.height)}function h(n,m){e.extend(n.data,b.call(l,n.data.left,n.data.top,n.data.width+0.1,n.data.height+0.1));e(l).window(m,n.data);k.pmask.remove();k.pmask=null;k.proxy.remove();k.proxy=null}}e(function(){if(!e._positionFixed){e(window).resize(function(){e("body>div.window-mask:visible").css({width:"",height:""});setTimeout(function(){e("body>div.window-mask:visible").css(e.fn.window.getMaskSize())},50)})}});e.fn.window=function(i,h){if(typeof i=="string"){var j=e.fn.window.methods[i];if(j){return j(this,h)}else{return this.panel(i,h)}}i=i||{};return this.each(function(){var k=e.data(this,"window");if(k){e.extend(k.options,i)}else{k=e.data(this,"window",{options:e.extend({},e.fn.window.defaults,e.fn.window.parseOptions(this),i)});if(!k.options.inline){document.body.appendChild(this)}}g(this);a(this)})};e.fn.window.methods={options:function(j){var i=j.panel("options");var h=e.data(j[0],"window").options;return e.extend(h,{closed:i.closed,collapsed:i.collapsed,minimized:i.minimized,maximized:i.maximized})},window:function(h){return e.data(h[0],"window").window},move:function(i,h){return i.each(function(){f(this,h)})},hcenter:function(h){return h.each(function(){d(this,true)})},vcenter:function(h){return h.each(function(){c(this,true)})},center:function(h){return h.each(function(){d(this);c(this);f(this)})}};e.fn.window.getMaskSize=function(h){var i=e(h).data("window");if(i&&i.options.inline){return{}}else{if(e._positionFixed){return{position:"fixed"}}else{return{width:e(document).width(),height:e(document).height()}}}};e.fn.window.parseOptions=function(h){return e.extend({},e.fn.panel.parseOptions(h),e.parser.parseOptions(h,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))};e.fn.window.defaults=e.extend({},e.fn.panel.defaults,{zIndex:9000,draggable:true,resizable:true,shadow:true,modal:false,border:true,inline:false,title:"New Window",collapsible:true,minimizable:true,maximizable:true,closable:true,closed:false,constrain:false})})(jQuery);