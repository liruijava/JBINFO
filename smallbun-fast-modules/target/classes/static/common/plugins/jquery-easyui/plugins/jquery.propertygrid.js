(function(d){var e;d(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(g){var f=d(g.target).closest("div.datagrid-view,div.combo-panel");if(f.length){return}c(e);e=undefined});function b(h){var g=d.data(h,"propertygrid");var f=d.data(h,"propertygrid").options;d(h).datagrid(d.extend({},f,{cls:"propertygrid",view:(f.showGroup?f.groupView:f.view),onBeforeEdit:function(k,j){if(f.onBeforeEdit.call(h,k,j)==false){return false}var l=d(this);var j=l.datagrid("getRows")[k];var i=l.datagrid("getColumnOption","value");i.editor=j.editor},onClickCell:function(n,l,k){if(e!=this){c(e);e=this}if(f.editIndex!=n){c(e);d(this).datagrid("beginEdit",n);var j=d(this).datagrid("getEditor",{index:n,field:l});if(!j){j=d(this).datagrid("getEditor",{index:n,field:"value"})}if(j){var m=d(j.target);var i=m.data("textbox")?m.textbox("textbox"):m;i.focus();f.editIndex=n}}f.onClickCell.call(h,n,l,k)},loadFilter:function(i){c(this);return f.loadFilter.call(this,i)}}))}function c(h){var f=d(h);if(!f.length){return}var g=d.data(h,"propertygrid").options;g.finder.getTr(h,null,"editing").each(function(){var i=parseInt(d(this).attr("datagrid-row-index"));if(f.datagrid("validateRow",i)){f.datagrid("endEdit",i)}else{f.datagrid("cancelEdit",i)}});g.editIndex=undefined}d.fn.propertygrid=function(h,g){if(typeof h=="string"){var f=d.fn.propertygrid.methods[h];if(f){return f(this,g)}else{return this.datagrid(h,g)}}h=h||{};return this.each(function(){var j=d.data(this,"propertygrid");if(j){d.extend(j.options,h)}else{var i=d.extend({},d.fn.propertygrid.defaults,d.fn.propertygrid.parseOptions(this),h);i.frozenColumns=d.extend(true,[],i.frozenColumns);i.columns=d.extend(true,[],i.columns);d.data(this,"propertygrid",{options:i})}b(this)})};d.fn.propertygrid.methods={options:function(f){return d.data(f[0],"propertygrid").options}};d.fn.propertygrid.parseOptions=function(f){return d.extend({},d.fn.datagrid.parseOptions(f),d.parser.parseOptions(f,[{showGroup:"boolean"}]))};var a=d.extend({},d.fn.datagrid.defaults.view,{render:function(f,l,k){var h=[];var g=this.groups;for(var j=0;j<g.length;j++){h.push(this.renderGroup.call(this,f,j,g[j],k))}d(l).html(h.join(""))},renderGroup:function(h,f,x,w){var u=d.data(h,"datagrid");var t=u.options;var q=d(h).datagrid("getColumnFields",w);var o=t.frozenColumns&&t.frozenColumns.length;if(w){if(!(t.rownumbers||o)){return""}}var n=[];var r=t.groupStyler.call(h,x.value,x.rows);var i=m(r,"datagrid-group");n.push("<div group-index="+f+" "+i+">");if((w&&(t.rownumbers||t.frozenColumns.length))||(!w&&!(t.rownumbers||t.frozenColumns.length))){n.push('<span class="datagrid-group-expander">');n.push('<span class="datagrid-row-expander datagrid-row-collapse">&nbsp;</span>');n.push("</span>")}if((w&&o)||(!w)){n.push('<span class="datagrid-group-title">');n.push(t.groupFormatter.call(h,x.value,x.rows));n.push("</span>")}n.push("</div>");n.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var l=x.startIndex;for(var y=0;y<x.rows.length;y++){var r=t.rowStyler?t.rowStyler.call(h,l,x.rows[y]):"";var k="";var v="";if(typeof r=="string"){v=r}else{if(r){k=r["class"]||"";v=r.style||""}}var g='class="datagrid-row '+(l%2&&t.striped?"datagrid-row-alt ":" ")+k+'"';var s=v?'style="'+v+'"':"";var p=u.rowIdPrefix+"-"+(w?1:2)+"-"+l;n.push('<tr id="'+p+'" datagrid-row-index="'+l+'" '+g+" "+s+">");n.push(this.renderRow.call(this,h,q,w,l,x.rows[y]));n.push("</tr>");l++}n.push("</tbody></table>");return n.join("");function m(B,j){var A="";var z="";if(typeof B=="string"){z=B}else{if(B){A=B["class"]||"";z=B.style||""}}return'class="'+j+(A?" "+A:"")+'" style="'+z+'"'}},bindEvents:function(i){var j=d.data(i,"datagrid");var g=j.dc;var h=g.body1.add(g.body2);var f=(d.data(h[0],"events")||d._data(h[0],"events")).click[0].handler;h.unbind("click").bind("click",function(m){var l=d(m.target);var k=l.closest("span.datagrid-row-expander");if(k.length){var n=k.closest("div.datagrid-group").attr("group-index");if(k.hasClass("datagrid-row-collapse")){d(i).datagrid("collapseGroup",n)}else{d(i).datagrid("expandGroup",n)}}else{f(m)}m.stopPropagation()})},onBeforeRender:function(p,n){var l=d.data(p,"datagrid");var j=l.options;f();var r=[];for(var g=0;g<n.length;g++){var s=n[g];var q=o(s[j.groupField]);if(!q){q={value:s[j.groupField],rows:[s]};r.push(q)}else{q.rows.push(s)}}var m=0;var k=[];for(var g=0;g<r.length;g++){var q=r[g];q.startIndex=m;m+=q.rows.length;k=k.concat(q.rows)}l.data.rows=k;this.groups=r;var h=this;setTimeout(function(){h.bindEvents(p)},0);function o(v){for(var u=0;u<r.length;u++){var t=r[u];if(t.value==v){return t}}return null}function f(){if(!d("#datagrid-group-style").length){d("head").append('<style id="datagrid-group-style">.datagrid-group{height:'+j.groupHeight+"px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;white-space:nowrap;word-break:normal;}.datagrid-group-title,.datagrid-group-expander{display:inline-block;vertical-align:bottom;height:100%;line-height:"+j.groupHeight+"px;padding:0 4px;}.datagrid-group-title{position:relative;}.datagrid-group-expander{width:"+j.expanderWidth+"px;text-align:center;padding:0}.datagrid-row-expander{margin:"+Math.floor((j.groupHeight-16)/2)+"px 0;display:inline-block;width:16px;height:16px;cursor:pointer}</style>")}}},onAfterRender:function(i){d.fn.datagrid.defaults.view.onAfterRender.call(this,i);var h=this;var g=d.data(i,"datagrid");var f=g.options;if(!g.onResizeColumn){g.onResizeColumn=f.onResizeColumn}if(!g.onResize){g.onResize=f.onResize}f.onResizeColumn=function(k,j){h.resizeGroup(i);g.onResizeColumn.call(i,k,j)};f.onResize=function(k,j){h.resizeGroup(i);g.onResize.call(d(i).datagrid("getPanel")[0],k,j)};h.resizeGroup(i)}});d.extend(d.fn.datagrid.methods,{groups:function(f){return f.datagrid("options").view.groups},expandGroup:function(g,f){return g.each(function(){var k=d(this).datagrid("options");var j=d.data(this,"datagrid").dc.view;var i=j.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var h=i.find("span.datagrid-row-expander");if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");i.next("table").show()}d(this).datagrid("fixRowHeight");if(k.onExpandGroup){k.onExpandGroup.call(this,f)}})},collapseGroup:function(g,f){return g.each(function(){var k=d(this).datagrid("options");var j=d.data(this,"datagrid").dc.view;var i=j.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var h=i.find("span.datagrid-row-expander");if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");i.next("table").hide()}d(this).datagrid("fixRowHeight");if(k.onCollapseGroup){k.onCollapseGroup.call(this,f)}})},scrollToGroup:function(g,f){return g.each(function(){var k=d.data(this,"datagrid");var j=k.dc;var i=j.body2.children('div.datagrid-group[group-index="'+f+'"]');if(i.length){var h=i.outerHeight();var n=j.view2.children("div.datagrid-header")._outerHeight();var m=j.body2.outerHeight(true)-j.body2.outerHeight();var l=i.position().top-n-m;if(l<0){j.body2.scrollTop(j.body2.scrollTop()+l)}else{if(l+h>j.body2.height()-18){j.body2.scrollTop(j.body2.scrollTop()+l+h-j.body2.height()+18)}}}})}});d.extend(a,{refreshGroupTitle:function(i,h){var f=d.data(i,"datagrid");var l=f.options;var g=f.dc;var k=this.groups[h];var j=g.body1.add(g.body2).children("div.datagrid-group[group-index="+h+"]").find("span.datagrid-group-title");j.html(l.groupFormatter.call(i,k.value,k.rows))},resizeGroup:function(n,m){var l=d.data(n,"datagrid");var p=l.dc;var o=p.header2.find("table");var i=o.find("tr.datagrid-filter-row").hide();var f=p.body2.children("table.datagrid-btable:first").width();if(m==undefined){var k=p.body2.children("div.datagrid-group")}else{var k=p.body2.children("div.datagrid-group[group-index="+m+"]")}k._outerWidth(f);var j=l.options;if(j.frozenColumns&&j.frozenColumns.length){var h=p.view1.width()-j.expanderWidth;var g=p.view1.css("direction").toLowerCase()=="rtl";k.find(".datagrid-group-title").css(g?"right":"left",-h+"px")}if(i.length){if(j.showFilterBar){i.show()}}},insertRow:function(j,h,p){var f=d.data(j,"datagrid");var n=f.options;var o=f.dc;var m=null;var l;if(!f.data.rows.length){d(j).datagrid("loadData",[p]);return}for(var g=0;g<this.groups.length;g++){if(this.groups[g].value==p[n.groupField]){m=this.groups[g];l=g;break}}if(m){if(h==undefined||h==null){h=f.data.rows.length}if(h<m.startIndex){h=m.startIndex}else{if(h>m.startIndex+m.rows.length){h=m.startIndex+m.rows.length}}d.fn.datagrid.defaults.view.insertRow.call(this,j,h,p);if(h>=m.startIndex+m.rows.length){k(h,true);k(h,false)}m.rows.splice(h-m.startIndex,0,p)}else{m={value:p[n.groupField],rows:[p],startIndex:f.data.rows.length};l=this.groups.length;o.body1.append(this.renderGroup.call(this,j,l,m,true));o.body2.append(this.renderGroup.call(this,j,l,m,false));this.groups.push(m);f.data.rows.push(p)}this.setGroupIndex(j);this.refreshGroupTitle(j,l);this.resizeGroup(j);function k(q,t){var i=t?1:2;var s=n.finder.getTr(j,q-1,"body",i);var r=n.finder.getTr(j,q,"body",i);r.insertAfter(s)}},updateRow:function(k,i,j){var h=d.data(k,"datagrid").options;d.fn.datagrid.defaults.view.updateRow.call(this,k,i,j);var f=h.finder.getTr(k,i,"body",2).closest("table.datagrid-btable");var g=parseInt(f.prev().attr("group-index"));this.refreshGroupTitle(k,g)},deleteRow:function(j,h){var g=d.data(j,"datagrid");var f=g.options;var p=g.dc;var m=p.body1.add(p.body2);var n=f.finder.getTr(j,h,"body",2).closest("table.datagrid-btable");var l=parseInt(n.prev().attr("group-index"));d.fn.datagrid.defaults.view.deleteRow.call(this,j,h);var k=this.groups[l];if(k.rows.length>1){k.rows.splice(h-k.startIndex,1);this.refreshGroupTitle(j,l)}else{m.children("div.datagrid-group[group-index="+l+"]").remove();for(var o=l+1;o<this.groups.length;o++){m.children("div.datagrid-group[group-index="+o+"]").attr("group-index",o-1)}this.groups.splice(l,1)}this.setGroupIndex(j)},setGroupIndex:function(h){var g=0;for(var j=0;j<this.groups.length;j++){var f=this.groups[j];f.startIndex=g;g+=f.rows.length}}});d.fn.propertygrid.defaults=d.extend({},d.fn.datagrid.defaults,{groupHeight:28,expanderWidth:20,singleSelect:true,remoteSort:false,fitColumns:true,loadMsg:"",frozenColumns:[[{field:"f",width:20,resizable:false}]],columns:[[{field:"name",title:"Name",width:100,sortable:true},{field:"value",title:"Value",width:100,resizable:false}]],showGroup:false,groupView:a,groupField:"group",groupStyler:function(g,f){return""},groupFormatter:function(f,g){return f}})})(jQuery);