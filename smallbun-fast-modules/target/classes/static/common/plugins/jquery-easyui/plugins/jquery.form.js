(function(f){function k(r,q){var p=f.data(r,"form").options;f.extend(p,q||{});var o=f.extend({},p.queryParams);if(p.onSubmit.call(r,o)==false){return}var n=f(r).find(".textbox-text:focus");n.triggerHandler("blur");n.focus();var m=null;if(p.dirty){var l=[];f.map(p.dirtyFields,function(s){if(f(s).hasClass("textbox-f")){f(s).next().find(".textbox-value").each(function(){l.push(this)})}else{l.push(s)}});m=f(r).find("input[name]:enabled,textarea[name]:enabled,select[name]:enabled").filter(function(){return f.inArray(this,l)==-1});m._propAttr("disabled",true)}if(p.ajax){if(p.iframe){h(r,o)}else{if(window.FormData!==undefined){g(r,o)}else{h(r,o)}}}else{f(r).submit()}if(p.dirty){m._propAttr("disabled",false)}}function h(t,s){var r=f.data(t,"form").options;var q="easyui_frame_"+(new Date().getTime());var p=f("<iframe id="+q+" name="+q+"></iframe>").appendTo("body");p.attr("src",window.ActiveXObject?"javascript:false":"updatelog:blank");p.css({position:"absolute",top:-1000,left:-1000});p.bind("load",l);o(s);function o(A){var y=f(t);if(r.url){y.attr("action",r.url)}var v=y.attr("target"),u=y.attr("action");y.attr("target",q);var x=f();try{for(var z in A){var w=f('<input type="hidden" name="'+z+'">').val(A[z]).appendTo(y);x=x.add(w)}n();y[0].submit()}finally{y.attr("action",u);v?y.attr("target",v):y.removeAttr("target");x.remove()}}function n(){var v=f("#"+q);if(!v.length){return}try{var u=v.contents()[0].readyState;if(u&&u.toLowerCase()=="uninitialized"){setTimeout(n,100)}}catch(w){l()}}var m=10;function l(){var x=f("#"+q);if(!x.length){return}x.unbind();var w="";try{var v=x.contents().find("body");w=v.html();if(w==""){if(--m){setTimeout(l,100);return}}var u=v.find(">textarea");if(u.length){w=u.val()}else{var z=v.find(">pre");if(z.length){w=z.html()}}}catch(y){}r.success.call(t,w);setTimeout(function(){x.unbind();x.remove()},100)}}function g(m,l){var p=f.data(m,"form").options;var o=new FormData(f(m)[0]);for(var n in l){o.append(n,l[n])}f.ajax({url:p.url,type:"post",xhr:function(){var q=f.ajaxSettings.xhr();if(q.upload){q.upload.addEventListener("progress",function(u){if(u.lengthComputable){var t=u.total;var s=u.loaded||u.position;var r=Math.ceil(s*100/t);p.onProgress.call(m,r)}},false)}return q},data:o,dataType:"html",cache:false,contentType:false,processData:false,complete:function(q){p.success.call(m,q.responseText)}})}function a(l,s){var r=f.data(l,"form").options;if(typeof s=="string"){var q={};if(r.onBeforeLoad.call(l,q)==false){return}f.ajax({url:s,data:q,dataType:"json",success:function(t){o(t)},error:function(){r.onLoadError.apply(l,arguments)}})}else{o(s)}function o(v){var u=f(l);for(var t in v){var w=v[t];if(!p(t,w)){if(!n(t,w)){u.find('input[name="'+t+'"]').val(w);u.find('textarea[name="'+t+'"]').val(w);u.find('select[name="'+t+'"]').val(w)}}}r.onLoadSuccess.call(l,v);u.form("validate")}function p(w,x){var v=["switchbutton","radiobutton","checkbox"];for(var u=0;u<v.length;u++){var t=v[u];var y=f(l).find("["+t+'Name="'+w+'"]');if(y.length){y[t]("uncheck");y.each(function(){if(m(f(this)[t]("options").value,x)){f(this)[t]("check")}});return true}}var y=f(l).find('input[name="'+w+'"][type=radio], input[name="'+w+'"][type=checkbox]');if(y.length){y._propAttr("checked",false);y.each(function(){if(m(f(this).val(),x)){f(this)._propAttr("checked",true)}});return true}return false}function m(t,u){if(t==String(u)||f.inArray(t,f.isArray(u)?u:[u])>=0){return true}else{return false}}function n(w,y){var v=f(l).find('[textboxName="'+w+'"],[sliderName="'+w+'"]');if(v.length){for(var x=0;x<r.fieldTypes.length;x++){var u=r.fieldTypes[x];var t=v.data(u);if(t){if(t.options.multiple||t.options.range){v[u]("setValues",y)}else{v[u]("setValue",y)}return true}}}return false}}function j(r){f("input,select,textarea",r).each(function(){if(f(this).hasClass("textbox-value")){return}var u=this.type,s=this.tagName.toLowerCase();if(u=="text"||u=="hidden"||u=="password"||s=="textarea"){this.value=""}else{if(u=="file"){var w=f(this);if(!w.hasClass("textbox-value")){var v=w.clone().val("");v.insertAfter(w);if(w.data("validatebox")){w.validatebox("destroy");v.validatebox()}else{w.remove()}}}else{if(u=="checkbox"||u=="radio"){this.checked=false}else{if(s=="select"){this.selectedIndex=-1}}}}});var m=f();var o=f(r);var n=f.data(r,"form").options;for(var l=0;l<n.fieldTypes.length;l++){var q=n.fieldTypes[l];var p=o.find("."+q+"-f").not(m);if(p.length&&p[q]){p[q]("clear");m=m.add(p)}}o.form("validate")}function i(q){q.reset();var p=f(q);var n=f.data(q,"form").options;for(var m=n.fieldTypes.length-1;m>=0;m--){var o=n.fieldTypes[m];var l=p.find("."+o+"-f");if(l.length&&l[o]){l[o]("reset")}}p.form("validate")}function e(m){var l=f.data(m,"form").options;f(m).unbind(".form");if(l.ajax){f(m).bind("submit.form",function(){setTimeout(function(){k(m,l)},0);return false})}f(m).bind("_change.form",function(o,n){if(f.inArray(n,l.dirtyFields)==-1){l.dirtyFields.push(n)}l.onChange.call(this,n)}).bind("change.form",function(o){var n=o.target;if(!f(n).hasClass("textbox-text")){if(f.inArray(n,l.dirtyFields)==-1){l.dirtyFields.push(n)}l.onChange.call(this,n)}});c(m,l.novalidate)}function b(n,m){m=m||{};var l=f.data(n,"form");if(l){f.extend(l.options,m)}else{f.data(n,"form",{options:f.extend({},f.fn.form.defaults,f.fn.form.parseOptions(n),m)})}}function d(n){if(f.fn.validatebox){var l=f(n);l.find(".validatebox-text:not(:disabled)").validatebox("validate");var m=l.find(".validatebox-invalid");m.filter(":not(:disabled):first").focus();return m.length==0}return true}function c(n,m){var l=f.data(n,"form").options;l.novalidate=m;f(n).find(".validatebox-text:not(:disabled)").validatebox(m?"disableValidation":"enableValidation")}f.fn.form=function(m,l){if(typeof m=="string"){this.each(function(){b(this)});return f.fn.form.methods[m](this,l)}return this.each(function(){b(this,m);e(this)})};f.fn.form.methods={options:function(l){return f.data(l[0],"form").options},submit:function(m,l){return m.each(function(){k(this,l)})},load:function(m,l){return m.each(function(){a(this,l)})},clear:function(l){return l.each(function(){j(this)})},reset:function(l){return l.each(function(){i(this)})},validate:function(l){return d(l[0])},disableValidation:function(l){return l.each(function(){c(this,true)})},enableValidation:function(l){return l.each(function(){c(this,false)})},resetValidation:function(l){return l.each(function(){f(this).find(".validatebox-text:not(:disabled)").validatebox("resetValidation")})},resetDirty:function(l){return l.each(function(){f(this).form("options").dirtyFields=[]})}};f.fn.form.parseOptions=function(l){var m=f(l);return f.extend({},f.parser.parseOptions(l,[{ajax:"boolean",dirty:"boolean"}]),{url:(m.attr("action")?m.attr("action"):undefined)})};f.fn.form.defaults={fieldTypes:["tagbox","combobox","combotree","combogrid","combotreegrid","datetimebox","datebox","combo","datetimespinner","timespinner","numberspinner","spinner","slider","searchbox","numberbox","passwordbox","filebox","textbox","switchbutton","radiobutton","checkbox"],novalidate:false,ajax:true,iframe:true,dirty:false,dirtyFields:[],url:null,queryParams:{},onSubmit:function(l){return f(this).form("validate")},onProgress:function(l){},success:function(l){},onBeforeLoad:function(l){},onLoadSuccess:function(l){},onLoadError:function(){},onChange:function(l){}}})(jQuery);