(function(e){function f(k){var j=e.data(k,"combotree");var i=j.options;var h=j.tree;e(k).addClass("combotree-f");e(k).combo(e.extend({},i,{onShowPanel:function(){if(i.editable){h.tree("doFilter","")}i.onShowPanel.call(this)}}));var g=e(k).combo("panel");if(!h){h=e("<ul></ul>").appendTo(g);j.tree=h}h.tree(e.extend({},i,{checkbox:i.multiple,onLoadSuccess:function(n,m){var l=e(k).combotree("getValues");if(i.multiple){e.map(h.tree("getChecked"),function(o){e.easyui.addArrayItem(l,o.id)})}d(k,l,j.remainText);i.onLoadSuccess.call(this,n,m)},onClick:function(l){if(i.multiple){e(this).tree(l.checked?"uncheck":"check",l.target)}else{e(k).combo("hidePanel")}j.remainText=false;a(k);i.onClick.call(this,l)},onCheck:function(m,l){j.remainText=false;a(k);i.onCheck.call(this,m,l)}}))}function a(l){var k=e.data(l,"combotree");var j=k.options;var i=k.tree;var h=[];if(j.multiple){h=e.map(i.tree("getChecked"),function(m){return m.id})}else{var g=i.tree("getSelected");if(g){h.push(g.id)}}h=h.concat(j.unselectedValues);d(l,h,k.remainText)}function d(m,l,j){var h=e.data(m,"combotree");var q=h.options;var p=h.tree;var o=p.tree("options");var n=o.onBeforeCheck;var k=o.onCheck;var i=o.onSelect;o.onBeforeCheck=o.onCheck=o.onSelect=function(){};if(!e.isArray(l)){l=l.split(q.separator)}if(!q.multiple){l=l.length?[l[0]]:[""]}var r=e.map(l,function(s){return String(s)});p.find("div.tree-node-selected").removeClass("tree-node-selected");e.map(p.tree("getChecked"),function(s){if(e.inArray(String(s.id),r)==-1){p.tree("uncheck",s.target)}});var v=[];q.unselectedValues=[];e.map(r,function(s){var w=p.tree("find",s);if(w){p.tree("check",w.target).tree("select",w.target);v.push(g(w))}else{v.push(t(s,q.mappingRows)||s);q.unselectedValues.push(s)}});if(q.multiple){e.map(p.tree("getChecked"),function(s){var w=String(s.id);if(e.inArray(w,r)==-1){r.push(w);v.push(g(s))}})}o.onBeforeCheck=n;o.onCheck=k;o.onSelect=i;if(!j){var u=v.join(q.separator);if(e(m).combo("getText")!=u){e(m).combo("setText",u)}}e(m).combo("setValues",r);function t(x,s){var w=e.easyui.getArrayItem(s,"id",x);return w?g(w):undefined}function g(s){return s[q.textField||""]||s.text}}function c(k,j){var i=e.data(k,"combotree");var h=i.options;var g=i.tree;i.remainText=true;g.tree("doFilter",h.multiple?j.split(h.separator):j)}function b(g){var h=e.data(g,"combotree");h.remainText=false;e(g).combotree("setValues",e(g).combotree("getValues"));e(g).combotree("hidePanel")}e.fn.combotree=function(i,h){if(typeof i=="string"){var g=e.fn.combotree.methods[i];if(g){return g(this,h)}else{return this.combo(i,h)}}i=i||{};return this.each(function(){var j=e.data(this,"combotree");if(j){e.extend(j.options,i)}else{e.data(this,"combotree",{options:e.extend({},e.fn.combotree.defaults,e.fn.combotree.parseOptions(this),i)})}f(this)})};e.fn.combotree.methods={options:function(h){var g=h.combo("options");return e.extend(e.data(h[0],"combotree").options,{width:g.width,height:g.height,originalValue:g.originalValue,disabled:g.disabled,readonly:g.readonly})},clone:function(i,h){var g=i.combo("clone",h);g.data("combotree",{options:e.extend(true,{},i.combotree("options")),tree:i.combotree("tree")});return g},tree:function(g){return e.data(g[0],"combotree").tree},loadData:function(h,g){return h.each(function(){var j=e.data(this,"combotree").options;j.data=g;var i=e.data(this,"combotree").tree;i.tree("loadData",g)})},reload:function(h,g){return h.each(function(){var j=e.data(this,"combotree").options;var i=e.data(this,"combotree").tree;if(g){j.url=g}i.tree({url:j.url})})},setValues:function(h,g){return h.each(function(){var i=e(this).combotree("options");if(e.isArray(g)){g=e.map(g,function(j){if(j&&typeof j=="object"){e.easyui.addArrayItem(i.mappingRows,"id",j);return j.id}else{return j}})}d(this,g)})},setValue:function(h,g){return h.each(function(){e(this).combotree("setValues",e.isArray(g)?g:[g])})},clear:function(g){return g.each(function(){e(this).combotree("setValues",[])})},reset:function(g){return g.each(function(){var h=e(this).combotree("options");if(h.multiple){e(this).combotree("setValues",h.originalValue)}else{e(this).combotree("setValue",h.originalValue)}})}};e.fn.combotree.parseOptions=function(g){return e.extend({},e.fn.combo.parseOptions(g),e.fn.tree.parseOptions(g))};e.fn.combotree.defaults=e.extend({},e.fn.combo.defaults,e.fn.tree.defaults,{editable:false,textField:null,unselectedValues:[],mappingRows:[],keyHandler:{up:function(g){},down:function(g){},left:function(g){},right:function(g){},enter:function(g){b(this)},query:function(g,h){c(this,g)}}})})(jQuery);