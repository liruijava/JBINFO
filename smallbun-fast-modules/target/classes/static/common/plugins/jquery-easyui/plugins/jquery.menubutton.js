(function(b){function c(k){var j=b.data(k,"menubutton").options;var i=b(k);i.linkbutton(j);if(j.hasDownArrow){i.removeClass(j.cls.btn1+" "+j.cls.btn2).addClass("m-btn");i.removeClass("m-btn-small m-btn-medium m-btn-large").addClass("m-btn-"+j.size);var h=i.find(".l-btn-left");b("<span></span>").addClass(j.cls.arrow).appendTo(h);b("<span></span>").addClass("m-btn-line").appendTo(h)}b(k).menubutton("resize");if(j.menu){b(j.menu).menu({duration:j.duration});var g=b(j.menu).menu("options");var f=g.onShow;var e=g.onHide;b.extend(g,{onShow:function(){var l=b(this).menu("options");var n=b(l.alignTo);var m=n.menubutton("options");n.addClass((m.plain==true)?m.cls.btn2:m.cls.btn1);f.call(this)},onHide:function(){var n=b(this).menu("options");var m=b(n.alignTo);var l=m.menubutton("options");m.removeClass((l.plain==true)?l.cls.btn2:l.cls.btn1);e.call(this)}})}}function d(j){var i=b.data(j,"menubutton").options;var f=b(j);var e=f.find("."+i.cls.trigger);if(!e.length){e=f}e.unbind(".menubutton");var h=null;e.bind(i.showEvent+".menubutton",function(){if(!g()){h=setTimeout(function(){a(j)},i.duration);return false}}).bind(i.hideEvent+".menubutton",function(){if(h){clearTimeout(h)}b(i.menu).triggerHandler("mouseleave")});function g(){return b(j).linkbutton("options").disabled}}function a(g){var f=b(g).menubutton("options");if(f.disabled||!f.menu){return}b("body>div.menu-top").menu("hide");var e=b(g);var h=b(f.menu);if(h.length){h.menu("options").alignTo=e;h.menu("show",{alignTo:e,align:f.menuAlign})}e.blur()}b.fn.menubutton=function(g,f){if(typeof g=="string"){var e=b.fn.menubutton.methods[g];if(e){return e(this,f)}else{return this.linkbutton(g,f)}}g=g||{};return this.each(function(){var h=b.data(this,"menubutton");if(h){b.extend(h.options,g)}else{b.data(this,"menubutton",{options:b.extend({},b.fn.menubutton.defaults,b.fn.menubutton.parseOptions(this),g)});b(this)._propAttr("disabled",false)}c(this);d(this)})};b.fn.menubutton.methods={options:function(f){var e=f.linkbutton("options");return b.extend(b.data(f[0],"menubutton").options,{toggle:e.toggle,selected:e.selected,disabled:e.disabled})},destroy:function(e){return e.each(function(){var f=b(this).menubutton("options");if(f.menu){b(f.menu).menu("destroy")}b(this).remove()})}};b.fn.menubutton.parseOptions=function(e){var f=b(e);return b.extend({},b.fn.linkbutton.parseOptions(e),b.parser.parseOptions(e,["menu",{plain:"boolean",hasDownArrow:"boolean",duration:"number"}]))};b.fn.menubutton.defaults=b.extend({},b.fn.linkbutton.defaults,{plain:true,hasDownArrow:true,menu:null,menuAlign:"left",duration:100,showEvent:"mouseenter",hideEvent:"mouseleave",cls:{btn1:"m-btn-active",btn2:"m-btn-plain-active",arrow:"m-btn-downarrow",trigger:"m-btn"}})})(jQuery);