(function(e){function i(m){var l=e(m).data("maskedbox");var k=l.options;e(m).textbox(k);e(m).maskedbox("initValue",k.value)}function h(m,l){var k=e(m).maskedbox("options");var p=(l||e(m).maskedbox("getText")||"").split("");var q=[];for(var o=0;o<k.mask.length;o++){if(k.masks[k.mask[o]]){var n=p[o];q.push(n!=k.promptChar?n:" ")}}return q.join("")}function f(v,u){var s=e(v).maskedbox("options");var l=u.split("");var p=[];for(var o=0;o<s.mask.length;o++){var n=s.mask[o];var k=s.masks[n];if(k){var t=l.shift();if(t!=undefined){var q=new RegExp(k,"i");if(q.test(t)){p.push(t);continue}}p.push(s.promptChar)}else{p.push(n)}}return p.join("")}function g(s,t){var p=e(s).maskedbox("options");var q=e(s).maskedbox("getSelectionRange");var o=d(s,q.start);var m=d(s,q.end);if(o!=-1){var k=new RegExp(p.masks[p.mask[o]],"i");if(k.test(t)){var u=h(s).split("");var n=o-c(s,o);var l=m-c(s,m);u.splice(n,l-n,t);e(s).maskedbox("setValue",f(s,u.join("")));o=d(s,++o);e(s).maskedbox("setSelectionRange",{start:o,end:o})}}}function a(n,l){var k=e(n).maskedbox("options");var s=h(n).split("");var r=e(n).maskedbox("getSelectionRange");if(r.start==r.end){if(l){var p=b(n,r.start)}else{var p=d(n,r.start)}var o=p-c(n,p);if(o>=0){s.splice(o,1)}}else{var p=d(n,r.start);var q=b(n,r.end);var o=p-c(n,p);var m=q-c(n,q);s.splice(o,m-o+1)}e(n).maskedbox("setValue",f(n,s.join("")));e(n).maskedbox("setSelectionRange",{start:p,end:p})}function c(l,o){var m=e(l).maskedbox("options");var k=0;if(o>=m.mask.length){o--}for(var n=o;n>=0;n--){if(m.masks[m.mask[n]]==undefined){k++}}return k}function d(p,o){var n=e(p).maskedbox("options");var k=n.mask[o];var l=n.masks[k];while(o<n.mask.length&&!l){o++;k=n.mask[o];l=n.masks[k]}return o}function b(o,p){var n=e(o).maskedbox("options");var k=n.mask[--p];var l=n.masks[k];while(p>=0&&!l){p--;k=n.mask[p];l=n.masks[k]}return p<0?0:p}function j(n){if(n.metaKey||n.ctrlKey){return}var m=n.data.target;var l=e(m).maskedbox("options");var k=[9,13,35,36,37,39];if(e.inArray(n.keyCode,k)!=-1){return true}if(n.keyCode>=96&&n.keyCode<=105){n.keyCode-=48}var o=String.fromCharCode(n.keyCode);if(n.keyCode>=65&&n.keyCode<=90&&!n.shiftKey){o=o.toLowerCase()}else{if(n.keyCode==189){o="-"}else{if(n.keyCode==187){o="+"}else{if(n.keyCode==190){o="."}}}}if(n.keyCode==8){a(m,true)}else{if(n.keyCode==46){a(m,false)}else{g(m,o)}}return false}e.extend(e.fn.textbox.methods,{inputMask:function(l,k){return l.each(function(){var p=this;var o=e.extend({},e.fn.maskedbox.defaults,k);e.data(p,"maskedbox",{options:o});var n=e(p).textbox("textbox");n.unbind(".maskedbox");for(var m in o.inputEvents){n.bind(m+".maskedbox",{target:p},o.inputEvents[m])}})}});e.fn.maskedbox=function(l,m){if(typeof l=="string"){var k=e.fn.maskedbox.methods[l];if(k){return k(this,m)}else{return this.textbox(l,m)}}l=l||{};return this.each(function(){var n=e.data(this,"maskedbox");if(n){e.extend(n.options,l)}else{e.data(this,"maskedbox",{options:e.extend({},e.fn.maskedbox.defaults,e.fn.maskedbox.parseOptions(this),l)})}i(this)})};e.fn.maskedbox.methods={options:function(l){var k=l.textbox("options");return e.extend(e.data(l[0],"maskedbox").options,{width:k.width,value:k.value,originalValue:k.originalValue,disabled:k.disabled,readonly:k.readonly})},initValue:function(l,k){return l.each(function(){k=f(this,h(this,k));e(this).textbox("initValue",k)})},setValue:function(l,k){return l.each(function(){k=f(this,h(this,k));e(this).textbox("setValue",k)})}};e.fn.maskedbox.parseOptions=function(l){var k=e(l);return e.extend({},e.fn.textbox.parseOptions(l),e.parser.parseOptions(l,["mask","promptChar"]),{})};e.fn.maskedbox.defaults=e.extend({},e.fn.textbox.defaults,{mask:"",promptChar:"_",masks:{"9":"[0-9]",a:"[a-zA-Z]","*":"[0-9a-zA-Z]"},inputEvents:{keydown:j}})})(jQuery);