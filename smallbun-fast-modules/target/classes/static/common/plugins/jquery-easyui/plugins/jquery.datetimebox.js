(function(e){function f(j){var i=e.data(j,"datetimebox");var h=i.options;e(j).datebox(e.extend({},h,{onShowPanel:function(){var l=e(this).datetimebox("getValue");b(this,l,true);h.onShowPanel.call(this)},formatter:e.fn.datebox.defaults.formatter,parser:e.fn.datebox.defaults.parser}));e(j).removeClass("datebox-f").addClass("datetimebox-f");e(j).datebox("calendar").calendar({onSelect:function(l){h.onSelect.call(this.target,l)}});if(!i.spinner){var g=e(j).datebox("panel");var k=e('<div style="padding:2px"><input></div>').insertAfter(g.children("div.datebox-calendar-inner"));i.spinner=k.children("input")}i.spinner.timespinner({width:h.spinnerWidth,showSeconds:h.showSeconds,separator:h.timeSeparator});e(j).datetimebox("initValue",h.value)}function c(g){var j=e(g).datetimebox("calendar");var i=e(g).datetimebox("spinner");var h=j.calendar("options").current;return new Date(h.getFullYear(),h.getMonth(),h.getDate(),i.timespinner("getHours"),i.timespinner("getMinutes"),i.timespinner("getSeconds"))}function d(g,h){b(g,h,true)}function a(i){var h=e.data(i,"datetimebox").options;var g=c(i);b(i,h.formatter.call(i,g));e(i).combo("hidePanel")}function b(l,k,j){var i=e.data(l,"datetimebox").options;e(l).combo("setValue",k);if(!j){if(k){var h=i.parser.call(l,k);e(l).combo("setText",i.formatter.call(l,h));e(l).combo("setValue",i.formatter.call(l,h))}else{e(l).combo("setText",k)}}var h=i.parser.call(l,k);e(l).datetimebox("calendar").calendar("moveTo",h);e(l).datetimebox("spinner").timespinner("setValue",g(h));function g(n){function m(p){return(p<10?"0":"")+p}var o=[m(n.getHours()),m(n.getMinutes())];if(i.showSeconds){o.push(m(n.getSeconds()))}return o.join(e(l).datetimebox("spinner").timespinner("options").separator)}}e.fn.datetimebox=function(i,h){if(typeof i=="string"){var g=e.fn.datetimebox.methods[i];if(g){return g(this,h)}else{return this.datebox(i,h)}}i=i||{};return this.each(function(){var j=e.data(this,"datetimebox");if(j){e.extend(j.options,i)}else{e.data(this,"datetimebox",{options:e.extend({},e.fn.datetimebox.defaults,e.fn.datetimebox.parseOptions(this),i)})}f(this)})};e.fn.datetimebox.methods={options:function(h){var g=h.datebox("options");return e.extend(e.data(h[0],"datetimebox").options,{originalValue:g.originalValue,disabled:g.disabled,readonly:g.readonly})},cloneFrom:function(h,g){return h.each(function(){e(this).datebox("cloneFrom",g);e.data(this,"datetimebox",{options:e.extend(true,{},e(g).datetimebox("options")),spinner:e(g).datetimebox("spinner")});e(this).removeClass("datebox-f").addClass("datetimebox-f")})},spinner:function(g){return e.data(g[0],"datetimebox").spinner},initValue:function(h,g){return h.each(function(){var j=e(this).datetimebox("options");var i=j.value;if(i){i=j.formatter.call(this,j.parser.call(this,i))}e(this).combo("initValue",i).combo("setText",i)})},setValue:function(h,g){return h.each(function(){b(this,g)})},reset:function(g){return g.each(function(){var h=e(this).datetimebox("options");e(this).datetimebox("setValue",h.originalValue)})}};e.fn.datetimebox.parseOptions=function(h){var g=e(h);return e.extend({},e.fn.datebox.parseOptions(h),e.parser.parseOptions(h,["timeSeparator","spinnerWidth",{showSeconds:"boolean"}]))};e.fn.datetimebox.defaults=e.extend({},e.fn.datebox.defaults,{spinnerWidth:"100%",showSeconds:true,timeSeparator:":",panelEvents:{mousedown:function(g){}},keyHandler:{up:function(g){},down:function(g){},left:function(g){},right:function(g){},enter:function(g){a(this)},query:function(g,h){d(this,g)}},buttons:[{text:function(g){return e(g).datetimebox("options").currentText},handler:function(h){var g=e(h).datetimebox("options");b(h,g.formatter.call(h,new Date()));e(h).datetimebox("hidePanel")}},{text:function(g){return e(g).datetimebox("options").okText},handler:function(g){a(g)}},{text:function(g){return e(g).datetimebox("options").closeText},handler:function(g){e(g).datetimebox("hidePanel")}}],formatter:function(j){var l=j.getHours();var n=j.getMinutes();var k=j.getSeconds();function i(h){return(h<10?"0":"")+h}var g=e(this).datetimebox("spinner").timespinner("options").separator;var m=e.fn.datebox.defaults.formatter(j)+" "+i(l)+g+i(n);if(e(this).datetimebox("options").showSeconds){m+=g+i(k)}return m},parser:function(j){if(e.trim(j)==""){return new Date()}var k=j.split(" ");var m=e.fn.datebox.defaults.parser(k[0]);if(k.length<2){return m}var h=e(this).datetimebox("spinner").timespinner("options").separator;var i=k[1].split(h);var g=parseInt(i[0],10)||0;var n=parseInt(i[1],10)||0;var l=parseInt(i[2],10)||0;return new Date(m.getFullYear(),m.getMonth(),m.getDate(),g,n,l)}})})(jQuery);