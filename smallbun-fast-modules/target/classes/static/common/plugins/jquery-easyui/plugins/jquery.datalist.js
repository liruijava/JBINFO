(function(b){function c(e){var d=b.data(e,"datalist").options;b(e).datagrid(b.extend({},d,{cls:"datalist"+(d.lines?" datalist-lines":""),frozenColumns:(d.frozenColumns&&d.frozenColumns.length)?d.frozenColumns:(d.checkbox?[[{field:"_ck",checkbox:true}]]:undefined),columns:(d.columns&&d.columns.length)?d.columns:[[{field:d.textField,width:"100%",formatter:function(h,g,f){return d.textFormatter?d.textFormatter(h,g,f):h}}]]}))}var a=b.extend({},b.fn.datagrid.defaults.view,{render:function(f,d,l){var j=b.data(f,"datagrid");var h=j.options;if(h.groupField){var m=this.groupRows(f,j.data.rows);this.groups=m.groups;j.data.rows=m.rows;var e=[];for(var k=0;k<m.groups.length;k++){e.push(this.renderGroup.call(this,f,k,m.groups[k],l))}b(d).html(e.join(""))}else{b(d).html(this.renderTable(f,0,j.data.rows,l))}},renderGroup:function(d,k,j,i){var h=b.data(d,"datagrid");var g=h.options;var f=b(d).datagrid("getColumnFields",i);var e=[];e.push('<div class="datagrid-group" group-index='+k+">");if(!i){e.push('<span class="datagrid-group-title">');e.push(g.groupFormatter.call(d,j.value,j.rows));e.push("</span>")}e.push("</div>");e.push(this.renderTable(d,j.startIndex,j.rows,i));return e.join("")},groupRows:function(h,f){var e=b.data(h,"datagrid");var d=e.options;var l=[];for(var m=0;m<f.length;m++){var n=f[m];var k=j(n[d.groupField]);if(!k){k={value:n[d.groupField],rows:[n]};l.push(k)}else{k.rows.push(n)}}var g=0;var f=[];for(var m=0;m<l.length;m++){var k=l[m];k.startIndex=g;g+=k.rows.length;f=f.concat(k.rows)}return{groups:l,rows:f};function j(p){for(var q=0;q<l.length;q++){var o=l[q];if(o.value==p){return o}}return null}}});b.fn.datalist=function(e,d){if(typeof e=="string"){var f=b.fn.datalist.methods[e];if(f){return f(this,d)}else{return this.datagrid(e,d)}}e=e||{};return this.each(function(){var i=b.data(this,"datalist");if(i){b.extend(i.options,e)}else{var h=b.extend({},b.fn.datalist.defaults,b.fn.datalist.parseOptions(this),e);h.columns=b.extend(true,[],h.columns);i=b.data(this,"datalist",{options:h})}c(this);if(!i.options.data){var g=b.fn.datalist.parseData(this);if(g.total){b(this).datalist("loadData",g)}}})};b.fn.datalist.methods={options:function(d){return b.data(d[0],"datalist").options}};b.fn.datalist.parseOptions=function(d){return b.extend({},b.fn.datagrid.parseOptions(d),b.parser.parseOptions(d,["valueField","textField","groupField",{checkbox:"boolean",lines:"boolean"}]))};b.fn.datalist.parseData=function(f){var e=b.data(f,"datalist").options;var d={total:0,rows:[]};b(f).children().each(function(){var h=b.parser.parseOptions(this,["value","group"]);var i={};var g=b(this).html();i[e.valueField]=h.value!=undefined?h.value:g;i[e.textField]=g;if(e.groupField){i[e.groupField]=h.group}d.total++;d.rows.push(i)});return d};b.fn.datalist.defaults=b.extend({},b.fn.datagrid.defaults,{fitColumns:true,singleSelect:true,showHeader:false,checkbox:false,lines:false,valueField:"value",textField:"text",groupField:"",view:a,textFormatter:function(d,e){return d},groupFormatter:function(e,d){return e}})})(jQuery);