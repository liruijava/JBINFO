(function(l){function n(u,t){var s=l.data(u,"combobox");return l.easyui.indexOfArray(s.data,s.options.valueField,t)}function j(v,u){var t=l.data(v,"combobox").options;var s=l(v).combo("panel");var w=t.finder.getEl(v,u);if(w.length){if(w.position().top<=0){var x=s.scrollTop()+w.position().top;s.scrollTop(x)}else{if(w.position().top+w.outerHeight()>s.height()){var x=s.scrollTop()+w.position().top+w.outerHeight()-s.height();s.scrollTop(x)}}}s.triggerHandler("scroll")}function m(u,t){var s=l.data(u,"combobox").options;var z=l(u).combobox("panel");var y=z.children("div.combobox-item-hover");if(!y.length){y=z.children("div.combobox-item-selected")}y.removeClass("combobox-item-hover");var x="div.combobox-item:visible:not(.combobox-item-disabled):first";var v="div.combobox-item:visible:not(.combobox-item-disabled):last";if(!y.length){y=z.children(t=="next"?x:v)}else{if(t=="next"){y=y.nextAll(x);if(!y.length){y=z.children(x)}}else{y=y.prevAll(x);if(!y.length){y=z.children(v)}}}if(y.length){y.addClass("combobox-item-hover");var w=s.finder.getRow(u,y);if(w){l(u).combobox("scrollTo",w[s.valueField]);if(s.selectOnNavigation){e(u,w[s.valueField])}}}}function e(w,v,u){var t=l.data(w,"combobox").options;var s=l(w).combo("getValues");if(l.inArray(v+"",s)==-1){if(t.multiple){s.push(v)}else{s=[v]}a(w,s,u)}}function g(w,v){var u=l.data(w,"combobox").options;var t=l(w).combo("getValues");var s=l.inArray(v+"",t);if(s>=0){t.splice(s,1);a(w,t)}}function a(y,w,u){var t=l.data(y,"combobox").options;var J=l(y).combo("panel");if(!l.isArray(w)){w=w.split(t.separator)}if(!t.multiple){w=w.length?[w[0]]:[""]}var F=l(y).combo("getValues");if(J.is(":visible")){J.find(".combobox-item-selected").each(function(){var s=t.finder.getRow(y,l(this));if(s){if(l.easyui.indexOfArray(F,s[t.valueField])==-1){l(this).removeClass("combobox-item-selected")}}})}l.map(F,function(s){if(l.easyui.indexOfArray(w,s)==-1){var K=t.finder.getEl(y,s);if(K.hasClass("combobox-item-selected")){K.removeClass("combobox-item-selected");t.onUnselect.call(y,t.finder.getRow(y,s))}}});var E=null;var B=[],I=[];for(var A=0;A<w.length;A++){var D=w[A];var H=D;var G=t.finder.getRow(y,D);if(G){H=G[t.textField];E=G;var x=t.finder.getEl(y,D);if(!x.hasClass("combobox-item-selected")){x.addClass("combobox-item-selected");t.onSelect.call(y,G)}}else{H=C(D,t.mappingRows)||D}B.push(D);I.push(H)}if(!u){l(y).combo("setText",I.join(t.separator))}if(t.showItemIcon){var z=l(y).combobox("textbox");z.removeClass("textbox-bgicon "+t.textboxIconCls);if(E&&E.iconCls){z.addClass("textbox-bgicon "+E.iconCls);t.textboxIconCls=E.iconCls}}l(y).combo("setValues",B);J.triggerHandler("scroll");function C(K,s){var v=l.easyui.getArrayItem(s,t.valueField,K);return v?v[t.textField]:undefined}}function p(w,v,u){var t=l.data(w,"combobox");var s=t.options;t.data=s.loadFilter.call(w,v);s.view.render.call(s.view,w,l(w).combo("panel"),t.data);var x=l(w).combobox("getValues");l.easyui.forEach(t.data,false,function(y){if(y.selected){l.easyui.addArrayItem(x,y[s.valueField]+"")}});if(s.multiple){a(w,x,u)}else{a(w,x.length?[x[x.length-1]]:[],u)}s.onLoadSuccess.call(w,v)}function r(u,v,t,s){var w=l.data(u,"combobox").options;if(v){w.url=v}t=l.extend({},w.queryParams,t||{});if(w.onBeforeLoad.call(u,t)==false){return}w.loader.call(u,t,function(x){p(u,x,s)},function(){w.onLoadError.apply(this,arguments)})}function q(v,s){var u=l.data(v,"combobox");var t=u.options;var z=l();var A=t.multiple?s.split(t.separator):[s];if(t.mode=="remote"){y(A);r(v,null,{q:s},true)}else{var x=l(v).combo("panel");x.find(".combobox-item-hover").removeClass("combobox-item-hover");x.find(".combobox-item,.combobox-group").hide();var w=u.data;var B=[];l.map(A,function(C){C=l.trim(C);var H=C;var F=undefined;z=l();for(var D=0;D<w.length;D++){var J=w[D];if(t.filter.call(v,C,J)){var I=J[t.valueField];var K=J[t.textField];var G=J[t.groupField];var E=t.finder.getEl(v,I).show();if(K.toLowerCase()==C.toLowerCase()){H=I;if(t.reversed){z=E}else{e(v,I,true)}}if(t.groupField&&F!=G){t.finder.getGroupEl(v,G).show();F=G}}}B.push(H)});y(B)}function y(C){if(t.reversed){z.addClass("combobox-item-hover")}else{a(v,t.multiple?(s?C:[]):C,true)}}}function k(w){var x=l(w);var v=x.combobox("options");var u=x.combobox("panel");var s=u.children("div.combobox-item-hover");if(s.length){s.removeClass("combobox-item-hover");var z=v.finder.getRow(w,s);var A=z[v.valueField];if(v.multiple){if(s.hasClass("combobox-item-selected")){x.combobox("unselect",A)}else{x.combobox("select",A)}}else{x.combobox("select",A)}}var y=[];l.map(x.combobox("getValues"),function(t){if(n(w,t)>=0){y.push(t)}});x.combobox("setValues",y);if(!v.multiple){x.combobox("hidePanel")}}function b(u){var t=l.data(u,"combobox");var s=t.options;l(u).addClass("combobox-f");l(u).combo(l.extend({},s,{onShowPanel:function(){l(this).combo("panel").find("div.combobox-item:hidden,div.combobox-group:hidden").show();a(this,l(this).combobox("getValues"),true);l(this).combobox("scrollTo",l(this).combobox("getValue"));s.onShowPanel.call(this)}}))}function h(s){l(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var t=l(s.target).closest("div.combobox-item");if(!t.hasClass("combobox-item-disabled")){t.addClass("combobox-item-hover")}s.stopPropagation()}function d(s){l(s.target).closest("div.combobox-item").removeClass("combobox-item-hover");s.stopPropagation()}function c(w){var u=l(this).panel("options").comboTarget;if(!u){return}var v=l(u).combobox("options");var t=l(w.target).closest("div.combobox-item");if(!t.length||t.hasClass("combobox-item-disabled")){return}var x=v.finder.getRow(u,t);if(!x){return}if(v.blurTimer){clearTimeout(v.blurTimer);v.blurTimer=null}v.onClick.call(u,x);var s=x[v.valueField];if(v.multiple){if(t.hasClass("combobox-item-selected")){g(u,s)}else{e(u,s)}}else{l(u).combobox("setValue",s).combobox("hidePanel")}w.stopPropagation()}function o(w){var v=l(this).panel("options").comboTarget;if(!v){return}var u=l(v).combobox("options");if(u.groupPosition=="sticky"){var t=l(this).children(".combobox-stick");if(!t.length){t=l('<div class="combobox-stick"></div>').appendTo(this)}t.hide();var s=l(v).data("combobox");l(this).children(".combobox-group:visible").each(function(){var y=l(this);var A=u.finder.getGroup(v,y);var z=s.data[A.startIndex+A.count-1];var x=u.finder.getEl(v,z[u.valueField]);if(y.position().top<0&&x.position().top>0){t.show().html(y.html());return false}})}}l.fn.combobox=function(t,s){if(typeof t=="string"){var u=l.fn.combobox.methods[t];if(u){return u(this,s)}else{return this.combo(t,s)}}t=t||{};return this.each(function(){var w=l.data(this,"combobox");if(w){l.extend(w.options,t)}else{w=l.data(this,"combobox",{options:l.extend({},l.fn.combobox.defaults,l.fn.combobox.parseOptions(this),t),data:[]})}b(this);if(w.options.data){p(this,w.options.data)}else{var v=l.fn.combobox.parseData(this);if(v.length){p(this,v)}}r(this)})};l.fn.combobox.methods={options:function(t){var s=t.combo("options");return l.extend(l.data(t[0],"combobox").options,{width:s.width,height:s.height,originalValue:s.originalValue,disabled:s.disabled,readonly:s.readonly})},cloneFrom:function(t,s){return t.each(function(){l(this).combo("cloneFrom",s);l.data(this,"combobox",l(s).data("combobox"));l(this).addClass("combobox-f").attr("comboboxName",l(this).attr("textboxName"))})},getData:function(s){return l.data(s[0],"combobox").data},setValues:function(t,s){return t.each(function(){var u=l(this).combobox("options");if(l.isArray(s)){s=l.map(s,function(v){if(v&&typeof v=="object"){l.easyui.addArrayItem(u.mappingRows,u.valueField,v);return v[u.valueField]}else{return v}})}a(this,s)})},setValue:function(t,s){return t.each(function(){l(this).combobox("setValues",l.isArray(s)?s:[s])})},clear:function(s){return s.each(function(){a(this,[])})},reset:function(s){return s.each(function(){var t=l(this).combobox("options");if(t.multiple){l(this).combobox("setValues",t.originalValue)}else{l(this).combobox("setValue",t.originalValue)}})},loadData:function(t,s){return t.each(function(){p(this,s)})},reload:function(t,s){return t.each(function(){if(typeof s=="string"){r(this,s)}else{if(s){var u=l(this).combobox("options");u.queryParams=s}r(this)}})},select:function(t,s){return t.each(function(){e(this,s)})},unselect:function(t,s){return t.each(function(){g(this,s)})},scrollTo:function(t,s){return t.each(function(){j(this,s)})}};l.fn.combobox.parseOptions=function(s){var u=l(s);return l.extend({},l.fn.combo.parseOptions(s),l.parser.parseOptions(s,["valueField","textField","groupField","groupPosition","mode","method","url",{showItemIcon:"boolean",limitToList:"boolean"}]))};l.fn.combobox.parseData=function(t){var s=[];var v=l(t).combobox("options");l(t).children().each(function(){if(this.tagName.toLowerCase()=="optgroup"){var w=l(this).attr("label");l(this).children().each(function(){u(this,w)})}else{u(this)}});return s;function u(x,z){var w=l(x);var y={};y[v.valueField]=w.attr("value")!=undefined?w.attr("value"):w.text();y[v.textField]=w.text();y.iconCls=l.parser.parseOptions(x,["iconCls"]).iconCls;y.selected=w.is(":selected");y.disabled=w.is(":disabled");if(z){v.groupField=v.groupField||"group";y[v.groupField]=z}s.push(y)}};var i=0;var f={render:function(y,x,w){var u=l.data(y,"combobox");var t=u.options;i++;u.itemIdPrefix="_easyui_combobox_i"+i;u.groupIdPrefix="_easyui_combobox_g"+i;u.groups=[];var D=[];var z=undefined;for(var A=0;A<w.length;A++){var G=w[A];var C=G[t.valueField]+"";var F=G[t.textField];var B=G[t.groupField];if(B){if(z!=B){z=B;u.groups.push({value:B,startIndex:A,count:1});D.push('<div id="'+(u.groupIdPrefix+"_"+(u.groups.length-1))+'" class="combobox-group">');D.push(t.groupFormatter?t.groupFormatter.call(y,B):B);D.push("</div>")}else{u.groups[u.groups.length-1].count++}}else{z=undefined}var E="combobox-item"+(G.disabled?" combobox-item-disabled":"")+(B?" combobox-gitem":"");D.push('<div id="'+(u.itemIdPrefix+"_"+A)+'" class="'+E+'">');if(t.showItemIcon&&G.iconCls){D.push('<span class="combobox-icon '+G.iconCls+'"></span>')}D.push(t.formatter?t.formatter.call(y,G):F);D.push("</div>")}l(x).html(D.join(""))}};l.fn.combobox.defaults=l.extend({},l.fn.combo.defaults,{valueField:"value",textField:"text",groupPosition:"static",groupField:null,groupFormatter:function(s){return s},mode:"local",method:"post",url:null,data:null,queryParams:{},showItemIcon:false,limitToList:false,unselectedValues:[],mappingRows:[],view:f,keyHandler:{up:function(s){m(this,"prev");s.preventDefault()},down:function(s){m(this,"next");s.preventDefault()},left:function(s){},right:function(s){},enter:function(s){k(this)},query:function(s,t){q(this,s)}},inputEvents:l.extend({},l.fn.combo.defaults.inputEvents,{blur:function(u){l.fn.combo.defaults.inputEvents.blur(u);var t=u.data.target;var s=l(t).combobox("options");if(s.reversed||s.limitToList){if(s.blurTimer){clearTimeout(s.blurTimer)}s.blurTimer=setTimeout(function(){var v=l(t).parent().length;if(v){if(s.reversed){l(t).combobox("setValues",l(t).combobox("getValues"))}else{if(s.limitToList){var w=[];l.map(l(t).combobox("getValues"),function(y){var x=l.easyui.indexOfArray(l(t).combobox("getData"),s.valueField,y);if(x>=0){w.push(y)}});l(t).combobox("setValues",w)}}s.blurTimer=null}},50)}}}),panelEvents:{mouseover:h,mouseout:d,mousedown:function(s){s.preventDefault();s.stopPropagation()},click:c,scroll:o},filter:function(t,u){var s=l(this).combobox("options");return u[s.textField].toLowerCase().indexOf(t.toLowerCase())>=0},formatter:function(t){var s=l(this).combobox("options");return t[s.textField]},loader:function(s,v,u){var t=l(this).combobox("options");if(!t.url){return false}l.ajax({type:t.method,url:t.url,data:s,dataType:"json",success:function(w){v(w)},error:function(){u.apply(this,arguments)}})},loadFilter:function(s){return s},finder:{getEl:function(t,s){var u=n(t,s);var v=l.data(t,"combobox").itemIdPrefix+"_"+u;return l("#"+v)},getGroupEl:function(v,u){var t=l.data(v,"combobox");var s=l.easyui.indexOfArray(t.groups,"value",u);var w=t.groupIdPrefix+"_"+s;return l("#"+w)},getGroup:function(t,v){var u=l.data(t,"combobox");var s=v.attr("id").substr(u.groupIdPrefix.length+1);return u.groups[parseInt(s)]},getRow:function(u,v){var t=l.data(u,"combobox");var s=(v instanceof l)?v.attr("id").substr(t.itemIdPrefix.length+1):n(u,v);return t.data[parseInt(s)]}},onBeforeLoad:function(s){},onLoadSuccess:function(s){},onLoadError:function(){},onSelect:function(s){},onUnselect:function(s){},onClick:function(s){}})})(jQuery);