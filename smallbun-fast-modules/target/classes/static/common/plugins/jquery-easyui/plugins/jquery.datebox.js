(function(d){function e(n){var m=d.data(n,"datebox");var l=m.options;d(n).addClass("datebox-f").combo(d.extend({},l,{onShowPanel:function(){j(this);i(this);h(this);b(this,d(this).datebox("getText"),true);l.onShowPanel.call(this)}}));if(!m.calendar){var g=d(n).combo("panel").css("overflow","hidden");g.panel("options").onBeforeDestroy=function(){var o=d(this).find(".calendar-shared");if(o.length){o.insertBefore(o[0].pholder)}};var f=d('<div class="datebox-calendar-inner"></div>').prependTo(g);if(l.sharedCalendar){var k=d(l.sharedCalendar);if(!k[0].pholder){k[0].pholder=d('<div class="calendar-pholder" style="display:none"></div>').insertAfter(k)}k.addClass("calendar-shared").appendTo(f);if(!k.hasClass("calendar")){k.calendar()}m.calendar=k}else{m.calendar=d("<div></div>").appendTo(f).calendar()}d.extend(m.calendar.calendar("options"),{fit:true,border:false,onSelect:function(o){var q=this.target;var p=d(q).datebox("options");p.onSelect.call(q,o);b(q,p.formatter.call(q,o));d(q).combo("hidePanel")}})}d(n).combo("textbox").parent().addClass("datebox");d(n).datebox("initValue",l.value);function j(q){var p=d(q).datebox("options");var o=d(q).combo("panel");o.unbind(".datebox").bind("click.datebox",function(r){if(d(r.target).hasClass("datebox-button-a")){var s=parseInt(d(r.target).attr("datebox-button-index"));p.buttons[s].handler.call(r.target,q)}})}function i(w){var u=d(w).combo("panel");if(u.children("div.datebox-button").length){return}var s=d('<div class="datebox-button"><table cellspacing="0" cellpadding="0" style="width:100%"><tr></tr></table></div>').appendTo(u);var r=s.find("tr");for(var q=0;q<l.buttons.length;q++){var v=d("<td></td>").appendTo(r);var p=l.buttons[q];var o=d('<a class="datebox-button-a" href="javascript:;"></a>').html(d.isFunction(p.text)?p.text(w):p.text).appendTo(v);o.attr("datebox-button-index",q)}r.find("td").css("width",(100/l.buttons.length)+"%")}function h(q){var p=d(q).combo("panel");var r=p.children("div.datebox-calendar-inner");p.children()._outerWidth(p.width());m.calendar.appendTo(r);m.calendar[0].target=q;if(l.panelHeight!="auto"){var o=p.height();p.children().not(r).each(function(){o-=d(this).outerHeight()});r._outerHeight(o)}m.calendar.calendar("resize")}}function c(f,g){b(f,g,true)}function a(i){var h=d.data(i,"datebox");var g=h.options;var f=h.calendar.calendar("options").current;if(f){b(i,g.formatter.call(i,f));d(i).combo("hidePanel")}}function b(i,g,h){var f=d.data(i,"datebox");var k=f.options;var j=f.calendar;j.calendar("moveTo",k.parser.call(i,g));if(h){d(i).combo("setValue",g)}else{if(g){g=k.formatter.call(i,j.calendar("options").current)}d(i).combo("setText",g).combo("setValue",g)}}d.fn.datebox=function(h,g){if(typeof h=="string"){var f=d.fn.datebox.methods[h];if(f){return f(this,g)}else{return this.combo(h,g)}}h=h||{};return this.each(function(){var i=d.data(this,"datebox");if(i){d.extend(i.options,h)}else{d.data(this,"datebox",{options:d.extend({},d.fn.datebox.defaults,d.fn.datebox.parseOptions(this),h)})}e(this)})};d.fn.datebox.methods={options:function(g){var f=g.combo("options");return d.extend(d.data(g[0],"datebox").options,{width:f.width,height:f.height,originalValue:f.originalValue,disabled:f.disabled,readonly:f.readonly})},cloneFrom:function(g,f){return g.each(function(){d(this).combo("cloneFrom",f);d.data(this,"datebox",{options:d.extend(true,{},d(f).datebox("options")),calendar:d(f).datebox("calendar")});d(this).addClass("datebox-f")})},calendar:function(f){return d.data(f[0],"datebox").calendar},initValue:function(g,f){return g.each(function(){var i=d(this).datebox("options");var h=i.value;if(h){h=i.formatter.call(this,i.parser.call(this,h))}d(this).combo("initValue",h).combo("setText",h)})},setValue:function(g,f){return g.each(function(){b(this,f)})},reset:function(f){return f.each(function(){var g=d(this).datebox("options");d(this).datebox("setValue",g.originalValue)})}};d.fn.datebox.parseOptions=function(f){return d.extend({},d.fn.combo.parseOptions(f),d.parser.parseOptions(f,["sharedCalendar"]))};d.fn.datebox.defaults=d.extend({},d.fn.combo.defaults,{panelWidth:250,panelHeight:"auto",sharedCalendar:null,keyHandler:{up:function(f){},down:function(f){},left:function(f){},right:function(f){},enter:function(f){a(this)},query:function(f,g){c(this,f)}},currentText:"Today",closeText:"Close",okText:"Ok",buttons:[{text:function(f){return d(f).datebox("options").currentText},handler:function(h){var g=d(h).datebox("options");var i=new Date();var f=new Date(i.getFullYear(),i.getMonth(),i.getDate());d(h).datebox("calendar").calendar({year:f.getFullYear(),month:f.getMonth()+1,current:f});g.onSelect.call(h,f);a(h)}},{text:function(f){return d(f).datebox("options").closeText},handler:function(f){d(this).closest("div.combo-panel").panel("close")}}],formatter:function(g){var i=g.getFullYear();var f=g.getMonth()+1;var h=g.getDate();return(f<10?("0"+f):f)+"/"+(h<10?("0"+h):h)+"/"+i},parser:function(h){if(!h){return new Date()}var g=h.split("/");var f=parseInt(g[0],10);var i=parseInt(g[1],10);var j=parseInt(g[2],10);if(!isNaN(j)&&!isNaN(f)&&!isNaN(i)){return new Date(j,f-1,i)}else{return new Date()}},onSelect:function(f){}})})(jQuery);