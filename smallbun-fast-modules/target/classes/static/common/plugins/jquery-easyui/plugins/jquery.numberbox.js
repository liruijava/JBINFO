(function(b){function c(h){var g=b.data(h,"numberbox");var f=g.options;b(h).addClass("numberbox-f").textbox(f);b(h).textbox("textbox").css({imeMode:"disabled"});b(h).attr("numberboxName",b(h).attr("textboxName"));g.numberbox=b(h).next();g.numberbox.addClass("numberbox");var e=f.parser.call(h,f.value);var d=f.formatter.call(h,e);b(h).numberbox("initValue",e).numberbox("setText",d)}function a(e,d){var h=b.data(e,"numberbox");var g=h.options;g.value=parseFloat(d);var d=g.parser.call(e,d);var f=g.formatter.call(e,d);g.value=d;b(e).textbox("setText",f).textbox("setValue",d);f=g.formatter.call(e,b(e).textbox("getValue"));b(e).textbox("setText",f)}b.fn.numberbox=function(e,d){if(typeof e=="string"){var f=b.fn.numberbox.methods[e];if(f){return f(this,d)}else{return this.textbox(e,d)}}e=e||{};return this.each(function(){var g=b.data(this,"numberbox");if(g){b.extend(g.options,e)}else{g=b.data(this,"numberbox",{options:b.extend({},b.fn.numberbox.defaults,b.fn.numberbox.parseOptions(this),e)})}c(this)})};b.fn.numberbox.methods={options:function(e){var d=e.data("textbox")?e.textbox("options"):{};return b.extend(b.data(e[0],"numberbox").options,{width:d.width,originalValue:d.originalValue,disabled:d.disabled,readonly:d.readonly})},cloneFrom:function(e,d){return e.each(function(){b(this).textbox("cloneFrom",d);b.data(this,"numberbox",{options:b.extend(true,{},b(d).numberbox("options"))});b(this).addClass("numberbox-f")})},fix:function(d){return d.each(function(){var f=b(this).numberbox("options");f.value=null;var e=f.parser.call(this,b(this).numberbox("getText"));b(this).numberbox("setValue",e)})},setValue:function(e,d){return e.each(function(){a(this,d)})},clear:function(d){return d.each(function(){b(this).textbox("clear");b(this).numberbox("options").value=""})},reset:function(d){return d.each(function(){b(this).textbox("reset");b(this).numberbox("setValue",b(this).numberbox("getValue"))})}};b.fn.numberbox.parseOptions=function(e){var d=b(e);return b.extend({},b.fn.textbox.parseOptions(e),b.parser.parseOptions(e,["decimalSeparator","groupSeparator","suffix",{min:"number",max:"number",precision:"number"}]),{prefix:(d.attr("prefix")?d.attr("prefix"):undefined)})};b.fn.numberbox.defaults=b.extend({},b.fn.textbox.defaults,{inputEvents:{keypress:function(g){var f=g.data.target;var d=b(f).numberbox("options");return d.filter.call(f,g)},blur:function(d){b(d.data.target).numberbox("fix")},keydown:function(d){if(d.keyCode==13){b(d.data.target).numberbox("fix")}}},min:null,max:null,precision:0,decimalSeparator:".",groupSeparator:"",prefix:"",suffix:"",filter:function(h){var d=b(this).numberbox("options");var g=b(this).numberbox("getText");if(h.metaKey||h.ctrlKey){return true}if(b.inArray(String(h.which),["46","8","13","0"])>=0){return true}var f=b("<span></span>");f.html(String.fromCharCode(h.which));var i=f.text();f.remove();if(!i){return true}if(i=="-"||i==d.decimalSeparator){return(g.indexOf(i)==-1)?true:false}else{if(i==d.groupSeparator){return true}else{if("0123456789".indexOf(i)>=0){return true}else{return false}}}},formatter:function(h){if(!h){return h}h=h+"";var g=b(this).numberbox("options");var f=h,e="";var d=h.indexOf(".");if(d>=0){f=h.substring(0,d);e=h.substring(d+1,h.length)}if(g.groupSeparator){var i=/(\d+)(\d{3})/;while(i.test(f)){f=f.replace(i,"$1"+g.groupSeparator+"$2")}}if(e){return g.prefix+f+g.decimalSeparator+e+g.suffix}else{return g.prefix+f+g.suffix}},parser:function(e){e=e+"";var d=b(this).numberbox("options");if(d.prefix){e=b.trim(e.replace(new RegExp("\\"+b.trim(d.prefix),"g"),""))}if(d.suffix){e=b.trim(e.replace(new RegExp("\\"+b.trim(d.suffix),"g"),""))}if(parseFloat(e)!=d.value){if(d.groupSeparator){e=b.trim(e.replace(new RegExp("\\"+d.groupSeparator,"g"),""))}if(d.decimalSeparator){e=b.trim(e.replace(new RegExp("\\"+d.decimalSeparator,"g"),"."))}e=e.replace(/\s/g,"")}var f=parseFloat(e).toFixed(d.precision);if(isNaN(f)){f=""}else{if(typeof(d.min)=="number"&&f<d.min){f=d.min.toFixed(d.precision)}else{if(typeof(d.max)=="number"&&f>d.max){f=d.max.toFixed(d.precision)}}}return f}})})(jQuery);