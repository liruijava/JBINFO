(function(g){function d(n){var j=g.data(n.data.target,"draggable");var i=j.options;var h=j.proxy;var m=n.data;var l=m.startLeft+n.pageX-m.startX;var k=m.startTop+n.pageY-m.startY;if(h){if(h.parent()[0]==document.body){if(i.deltaX!=null&&i.deltaX!=undefined){l=n.pageX+i.deltaX}else{l=n.pageX-n.data.offsetWidth}if(i.deltaY!=null&&i.deltaY!=undefined){k=n.pageY+i.deltaY}else{k=n.pageY-n.data.offsetHeight}}else{if(i.deltaX!=null&&i.deltaX!=undefined){l+=n.data.offsetWidth+i.deltaX}if(i.deltaY!=null&&i.deltaY!=undefined){k+=n.data.offsetHeight+i.deltaY}}}if(n.data.parent!=document.body){l+=g(n.data.parent).scrollLeft();k+=g(n.data.parent).scrollTop()}if(i.axis=="h"){m.left=l}else{if(i.axis=="v"){m.top=k}else{m.left=l;m.top=k}}}function f(k){var j=g.data(k.data.target,"draggable");var i=j.options;var h=j.proxy;if(!h){h=g(k.data.target)}h.css({left:k.data.left,top:k.data.top});g("body").css("cursor",i.cursor)}function a(l){if(!g.fn.draggable.isDragging){return false}var k=g.data(l.data.target,"draggable");var j=k.options;var h=g(".droppable:visible").filter(function(){return l.data.target!=this}).filter(function(){var m=g.data(this,"droppable").options.accept;if(m){return g(m).filter(function(){return this==l.data.target}).length>0}else{return true}});k.droppables=h;var i=k.proxy;if(!i){if(j.proxy){if(j.proxy=="clone"){i=g(l.data.target).clone().insertAfter(l.data.target)}else{i=j.proxy.call(l.data.target,l.data.target)}k.proxy=i}else{i=g(l.data.target)}}i.css("position","absolute");d(l);f(l);j.onStartDrag.call(l.data.target,l);return false}function c(j){if(!g.fn.draggable.isDragging){return false}var i=g.data(j.data.target,"draggable");d(j);if(i.options.onDrag.call(j.data.target,j)!=false){f(j)}var h=j.data.target;i.droppables.each(function(){var l=g(this);if(l.droppable("options").disabled){return}var k=l.offset();if(j.pageX>k.left&&j.pageX<k.left+l.outerWidth()&&j.pageY>k.top&&j.pageY<k.top+l.outerHeight()){if(!this.entered){g(this).trigger("_dragenter",[h]);this.entered=true}g(this).trigger("_dragover",[h])}else{if(this.entered){g(this).trigger("_dragleave",[h]);this.entered=false}}});return false}function e(o){if(!g.fn.draggable.isDragging){b();return false}c(o);var k=g.data(o.data.target,"draggable");var h=k.proxy;var j=k.options;j.onEndDrag.call(o.data.target,o);if(j.revert){if(l()==true){g(o.data.target).css({position:o.data.startPosition,left:o.data.startLeft,top:o.data.startTop})}else{if(h){var n,m;if(h.parent()[0]==document.body){n=o.data.startX-o.data.offsetWidth;m=o.data.startY-o.data.offsetHeight}else{n=o.data.startLeft;m=o.data.startTop}h.animate({left:n,top:m},function(){i()})}else{g(o.data.target).animate({left:o.data.startLeft,top:o.data.startTop},function(){g(o.data.target).css("position",o.data.startPosition)})}}}else{g(o.data.target).css({position:"absolute",left:o.data.left,top:o.data.top});l()}j.onStopDrag.call(o.data.target,o);b();function i(){if(h){h.remove()}k.proxy=null}function l(){var p=false;k.droppables.each(function(){var r=g(this);if(r.droppable("options").disabled){return}var q=r.offset();if(o.pageX>q.left&&o.pageX<q.left+r.outerWidth()&&o.pageY>q.top&&o.pageY<q.top+r.outerHeight()){if(j.revert){g(o.data.target).css({position:o.data.startPosition,left:o.data.startLeft,top:o.data.startTop})}g(this).triggerHandler("_drop",[o.data.target]);i();p=true;this.entered=false;return false}});if(!p&&!j.revert){i()}return p}return false}function b(){if(g.fn.draggable.timer){clearTimeout(g.fn.draggable.timer);g.fn.draggable.timer=undefined}g(document).unbind(".draggable");g.fn.draggable.isDragging=false;setTimeout(function(){g("body").css("cursor","")},100)}g.fn.draggable=function(h,i){if(typeof h=="string"){return g.fn.draggable.methods[h](this,i)}return this.each(function(){var k;var m=g.data(this,"draggable");if(m){m.handle.unbind(".draggable");k=g.extend(m.options,h)}else{k=g.extend({},g.fn.draggable.defaults,g.fn.draggable.parseOptions(this),h||{})}var l=k.handle?(typeof k.handle=="string"?g(k.handle,this):k.handle):g(this);g.data(this,"draggable",{options:k,handle:l});if(k.disabled){g(this).css("cursor","");return}l.unbind(".draggable").bind("mousemove.draggable",{target:this},function(o){if(g.fn.draggable.isDragging){return}var n=g.data(o.data.target,"draggable").options;if(j(o)){g(this).css("cursor",n.cursor)}else{g(this).css("cursor","")}}).bind("mouseleave.draggable",{target:this},function(n){g(this).css("cursor","")}).bind("mousedown.draggable",{target:this},function(q){if(j(q)==false){return}g(this).css("cursor","");var n=g(q.data.target).position();var r=g(q.data.target).offset();var p={startPosition:g(q.data.target).css("position"),startLeft:n.left,startTop:n.top,left:n.left,top:n.top,startX:q.pageX,startY:q.pageY,width:g(q.data.target).outerWidth(),height:g(q.data.target).outerHeight(),offsetWidth:(q.pageX-r.left),offsetHeight:(q.pageY-r.top),target:q.data.target,parent:g(q.data.target).parent()[0]};g.extend(q.data,p);var o=g.data(q.data.target,"draggable").options;if(o.onBeforeDrag.call(q.data.target,q)==false){return}g(document).bind("mousedown.draggable",q.data,a);g(document).bind("mousemove.draggable",q.data,c);g(document).bind("mouseup.draggable",q.data,e);g.fn.draggable.timer=setTimeout(function(){g.fn.draggable.isDragging=true;a(q)},o.delay);return false});function j(v){var o=g.data(v.data.target,"draggable");var u=o.handle;var s=g(u).offset();var p=g(u).outerWidth();var x=g(u).outerHeight();var y=v.pageY-s.top;var n=s.left+p-v.pageX;var w=s.top+x-v.pageY;var q=v.pageX-s.left;return Math.min(y,n,w,q)>o.options.edge}})};g.fn.draggable.methods={options:function(h){return g.data(h[0],"draggable").options},proxy:function(h){return g.data(h[0],"draggable").proxy},enable:function(h){return h.each(function(){g(this).draggable({disabled:false})})},disable:function(h){return h.each(function(){g(this).draggable({disabled:true})})}};g.fn.draggable.parseOptions=function(i){var h=g(i);return g.extend({},g.parser.parseOptions(i,["cursor","handle","axis",{revert:"boolean",deltaX:"number",deltaY:"number",edge:"number",delay:"number"}]),{disabled:(h.attr("disabled")?true:undefined)})};g.fn.draggable.defaults={proxy:null,revert:false,cursor:"move",deltaX:null,deltaY:null,handle:null,disabled:false,edge:0,axis:null,delay:100,onBeforeDrag:function(h){},onStartDrag:function(h){},onDrag:function(h){},onEndDrag:function(h){},onStopDrag:function(h){}};g.fn.draggable.isDragging=false})(jQuery);