(function(c){function b(l){var h=c.data(l,"datebox");var f=h.options;c(l).addClass("datebox-f").combo(c.extend({},f,{onShowPanel:function(){j(this);k(this);n(this);d(this,c(this).datebox("getText"),true);f.onShowPanel.call(this)}}));if(!h.calendar){var g=c(l).combo("panel").css("overflow","hidden");g.panel("options").onBeforeDestroy=function(){var o=c(this).find(".calendar-shared");if(o.length){o.insertBefore(o[0].pholder)}};var i=c('<div class="datebox-calendar-inner"></div>').prependTo(g);if(f.sharedCalendar){var m=c(f.sharedCalendar);if(!m[0].pholder){m[0].pholder=c('<div class="calendar-pholder" style="display:none"></div>').insertAfter(m)}m.addClass("calendar-shared").appendTo(i);if(!m.hasClass("calendar")){m.calendar()}h.calendar=m}else{h.calendar=c("<div></div>").appendTo(i).calendar()}c.extend(h.calendar.calendar("options"),{fit:true,border:false,onSelect:function(o){var q=this.target;var p=c(q).datebox("options");p.onSelect.call(q,o);d(q,p.formatter.call(q,o));c(q).combo("hidePanel")}})}c(l).combo("textbox").parent().addClass("datebox");c(l).datebox("initValue",f.value);function j(q){var p=c(q).datebox("options");var o=c(q).combo("panel");o.unbind(".datebox").bind("click.datebox",function(s){if(c(s.target).hasClass("datebox-button-a")){var r=parseInt(c(s.target).attr("datebox-button-index"));p.buttons[r].handler.call(s.target,q)}})}function k(v){var o=c(v).combo("panel");if(o.children("div.datebox-button").length){return}var s=c('<div class="datebox-button"><table cellspacing="0" cellpadding="0" style="width:100%"><tr></tr></table></div>').appendTo(o);var u=s.find("tr");for(var r=0;r<f.buttons.length;r++){var w=c("<td></td>").appendTo(u);var q=f.buttons[r];var p=c('<a class="datebox-button-a" href="javascript:;"></a>').html(c.isFunction(q.text)?q.text(v):q.text).appendTo(w);p.attr("datebox-button-index",r)}u.find("td").css("width",(100/f.buttons.length)+"%")}function n(q){var p=c(q).combo("panel");var r=p.children("div.datebox-calendar-inner");p.children()._outerWidth(p.width());h.calendar.appendTo(r);h.calendar[0].target=q;if(f.panelHeight!="auto"){var o=p.height();p.children().not(r).each(function(){o-=c(this).outerHeight()});r._outerHeight(o)}h.calendar.calendar("resize")}}function e(g,f){d(g,f,true)}function a(i){var g=c.data(i,"datebox");var f=g.options;var h=g.calendar.calendar("options").current;if(h){d(i,f.formatter.call(i,h));c(i).combo("hidePanel")}}function d(k,i,g){var h=c.data(k,"datebox");var f=h.options;var j=h.calendar;j.calendar("moveTo",f.parser.call(k,i));if(g){c(k).combo("setValue",i)}else{if(i){i=f.formatter.call(k,j.calendar("options").current)}c(k).combo("setText",i).combo("setValue",i)}}c.fn.datebox=function(f,g){if(typeof f=="string"){var h=c.fn.datebox.methods[f];if(h){return h(this,g)}else{return this.combo(f,g)}}f=f||{};return this.each(function(){var i=c.data(this,"datebox");if(i){c.extend(i.options,f)}else{c.data(this,"datebox",{options:c.extend({},c.fn.datebox.defaults,c.fn.datebox.parseOptions(this),f)})}b(this)})};c.fn.datebox.methods={options:function(g){var f=g.combo("options");return c.extend(c.data(g[0],"datebox").options,{width:f.width,height:f.height,originalValue:f.originalValue,disabled:f.disabled,readonly:f.readonly})},cloneFrom:function(g,f){return g.each(function(){c(this).combo("cloneFrom",f);c.data(this,"datebox",{options:c.extend(true,{},c(f).datebox("options")),calendar:c(f).datebox("calendar")});c(this).addClass("datebox-f")})},calendar:function(f){return c.data(f[0],"datebox").calendar},initValue:function(g,f){return g.each(function(){var h=c(this).datebox("options");var i=h.value;if(i){i=h.formatter.call(this,h.parser.call(this,i))}c(this).combo("initValue",i).combo("setText",i)})},setValue:function(g,f){return g.each(function(){d(this,f)})},reset:function(f){return f.each(function(){var g=c(this).datebox("options");c(this).datebox("setValue",g.originalValue)})}};c.fn.datebox.parseOptions=function(f){return c.extend({},c.fn.combo.parseOptions(f),c.parser.parseOptions(f,["sharedCalendar"]))};c.fn.datebox.defaults=c.extend({},c.fn.combo.defaults,{panelWidth:250,panelHeight:"auto",sharedCalendar:null,keyHandler:{up:function(f){},down:function(f){},left:function(f){},right:function(f){},enter:function(f){a(this)},query:function(f,g){e(this,f)}},currentText:"Today",closeText:"Close",okText:"Ok",buttons:[{text:function(f){return c(f).datebox("options").currentText},handler:function(i){var g=c(i).datebox("options");var f=new Date();var h=new Date(f.getFullYear(),f.getMonth(),f.getDate());c(i).datebox("calendar").calendar({year:h.getFullYear(),month:h.getMonth()+1,current:h});g.onSelect.call(i,h);a(i)}},{text:function(f){return c(f).datebox("options").closeText},handler:function(f){c(this).closest("div.combo-panel").panel("close")}}],formatter:function(g){var i=g.getFullYear();var f=g.getMonth()+1;var h=g.getDate();return(f<10?("0"+f):f)+"/"+(h<10?("0"+h):h)+"/"+i},parser:function(h){if(!h){return new Date()}var g=h.split("/");var f=parseInt(g[0],10);var i=parseInt(g[1],10);var j=parseInt(g[2],10);if(!isNaN(j)&&!isNaN(f)&&!isNaN(i)){return new Date(j,f-1,i)}else{return new Date()}},onSelect:function(f){}})})(jQuery);