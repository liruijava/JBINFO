(function(e){function c(q,o){var p=e.data(q,"form").options;e.extend(p,o||{});var r=e.extend({},p.queryParams);if(p.onSubmit.call(q,r)==false){return}var n=e(q).find(".textbox-text:focus");n.triggerHandler("blur");n.focus();var l=null;if(p.dirty){var m=[];e.map(p.dirtyFields,function(s){if(e(s).hasClass("textbox-f")){e(s).next().find(".textbox-value").each(function(){m.push(this)})}else{m.push(s)}});l=e(q).find("input[name]:enabled,textarea[name]:enabled,select[name]:enabled").filter(function(){return e.inArray(this,m)==-1});l._propAttr("disabled",true)}if(p.ajax){if(p.iframe){b(q,r)}else{if(window.FormData!==undefined){a(q,r)}else{b(q,r)}}}else{e(q).submit()}if(p.dirty){l._propAttr("disabled",false)}}function b(q,n){var l=e.data(q,"form").options;var r="easyui_frame_"+(new Date().getTime());var m=e("<iframe id="+r+" name="+r+"></iframe>").appendTo("body");m.attr("src",window.ActiveXObject?"javascript:false":"updatelog:blank");m.css({position:"absolute",top:-1000,left:-1000});m.bind("load",o);s(n);function s(z){var x=e(q);if(l.url){x.attr("action",l.url)}var v=x.attr("target"),u=x.attr("action");x.attr("target",r);var w=e();try{for(var A in z){var y=e('<input type="hidden" name="'+A+'">').val(z[A]).appendTo(x);w=w.add(y)}t();x[0].submit()}finally{x.attr("action",u);v?x.attr("target",v):x.removeAttr("target");w.remove()}}function t(){var v=e("#"+r);if(!v.length){return}try{var u=v.contents()[0].readyState;if(u&&u.toLowerCase()=="uninitialized"){setTimeout(t,100)}}catch(w){o()}}var p=10;function o(){var x=e("#"+r);if(!x.length){return}x.unbind();var w="";try{var u=x.contents().find("body");w=u.html();if(w==""){if(--p){setTimeout(o,100);return}}var v=u.find(">textarea");if(v.length){w=v.val()}else{var z=u.find(">pre");if(z.length){w=z.html()}}}catch(y){}l.success.call(q,w);setTimeout(function(){x.unbind();x.remove()},100)}}function a(o,p){var m=e.data(o,"form").options;var n=new FormData(e(o)[0]);for(var l in p){n.append(l,p[l])}e.ajax({url:m.url,type:"post",xhr:function(){var q=e.ajaxSettings.xhr();if(q.upload){q.upload.addEventListener("progress",function(u){if(u.lengthComputable){var t=u.total;var r=u.loaded||u.position;var s=Math.ceil(r*100/t);m.onProgress.call(o,s)}},false)}return q},data:n,dataType:"html",cache:false,contentType:false,processData:false,complete:function(q){m.success.call(o,q.responseText)}})}function k(q,p){var o=e.data(q,"form").options;if(typeof p=="string"){var r={};if(o.onBeforeLoad.call(q,r)==false){return}e.ajax({url:p,data:r,dataType:"json",success:function(t){n(t)},error:function(){o.onLoadError.apply(q,arguments)}})}else{n(p)}function n(v){var u=e(q);for(var t in v){var w=v[t];if(!l(t,w)){if(!m(t,w)){u.find('input[name="'+t+'"]').val(w);u.find('textarea[name="'+t+'"]').val(w);u.find('select[name="'+t+'"]').val(w)}}}o.onLoadSuccess.call(q,v);u.form("validate")}function l(u,x){var t=["switchbutton","radiobutton","checkbox"];for(var v=0;v<t.length;v++){var w=t[v];var y=e(q).find("["+w+'Name="'+u+'"]');if(y.length){y[w]("uncheck");y.each(function(){if(s(e(this)[w]("options").value,x)){e(this)[w]("check")}});return true}}var y=e(q).find('input[name="'+u+'"][type=radio], input[name="'+u+'"][type=checkbox]');if(y.length){y._propAttr("checked",false);y.each(function(){if(s(e(this).val(),x)){e(this)._propAttr("checked",true)}});return true}return false}function s(t,u){if(t==String(u)||e.inArray(t,e.isArray(u)?u:[u])>=0){return true}else{return false}}function m(t,y){var x=e(q).find('[textboxName="'+t+'"],[sliderName="'+t+'"]');if(x.length){for(var u=0;u<o.fieldTypes.length;u++){var v=o.fieldTypes[u];var w=x.data(v);if(w){if(w.options.multiple||w.options.range){x[v]("setValues",y)}else{x[v]("setValue",y)}return true}}}return false}}function f(r){e("input,select,textarea",r).each(function(){if(e(this).hasClass("textbox-value")){return}var v=this.type,s=this.tagName.toLowerCase();if(v=="text"||v=="hidden"||v=="password"||s=="textarea"){this.value=""}else{if(v=="file"){var u=e(this);if(!u.hasClass("textbox-value")){var w=u.clone().val("");w.insertAfter(u);if(u.data("validatebox")){u.validatebox("destroy");w.validatebox()}else{u.remove()}}}else{if(v=="checkbox"||v=="radio"){this.checked=false}else{if(s=="select"){this.selectedIndex=-1}}}}});var m=e();var p=e(r);var o=e.data(r,"form").options;for(var l=0;l<o.fieldTypes.length;l++){var n=o.fieldTypes[l];var q=p.find("."+n+"-f").not(m);if(q.length&&q[n]){q[n]("clear");m=m.add(q)}}p.form("validate")}function h(q){q.reset();var o=e(q);var n=e.data(q,"form").options;for(var l=n.fieldTypes.length-1;l>=0;l--){var m=n.fieldTypes[l];var p=o.find("."+m+"-f");if(p.length&&p[m]){p[m]("reset")}}o.form("validate")}function i(m){var l=e.data(m,"form").options;e(m).unbind(".form");if(l.ajax){e(m).bind("submit.form",function(){setTimeout(function(){c(m,l)},0);return false})}e(m).bind("_change.form",function(o,n){if(e.inArray(n,l.dirtyFields)==-1){l.dirtyFields.push(n)}l.onChange.call(this,n)}).bind("change.form",function(o){var n=o.target;if(!e(n).hasClass("textbox-text")){if(e.inArray(n,l.dirtyFields)==-1){l.dirtyFields.push(n)}l.onChange.call(this,n)}});d(m,l.novalidate)}function g(n,l){l=l||{};var m=e.data(n,"form");if(m){e.extend(m.options,l)}else{e.data(n,"form",{options:e.extend({},e.fn.form.defaults,e.fn.form.parseOptions(n),l)})}}function j(m){if(e.fn.validatebox){var l=e(m);l.find(".validatebox-text:not(:disabled)").validatebox("validate");var n=l.find(".validatebox-invalid");n.filter(":not(:disabled):first").focus();return n.length==0}return true}function d(n,l){var m=e.data(n,"form").options;m.novalidate=l;e(n).find(".validatebox-text:not(:disabled)").validatebox(l?"disableValidation":"enableValidation")}e.fn.form=function(l,m){if(typeof l=="string"){this.each(function(){g(this)});return e.fn.form.methods[l](this,m)}return this.each(function(){g(this,l);i(this)})};e.fn.form.methods={options:function(l){return e.data(l[0],"form").options},submit:function(m,l){return m.each(function(){c(this,l)})},load:function(m,l){return m.each(function(){k(this,l)})},clear:function(l){return l.each(function(){f(this)})},reset:function(l){return l.each(function(){h(this)})},validate:function(l){return j(l[0])},disableValidation:function(l){return l.each(function(){d(this,true)})},enableValidation:function(l){return l.each(function(){d(this,false)})},resetValidation:function(l){return l.each(function(){e(this).find(".validatebox-text:not(:disabled)").validatebox("resetValidation")})},resetDirty:function(l){return l.each(function(){e(this).form("options").dirtyFields=[]})}};e.fn.form.parseOptions=function(m){var l=e(m);return e.extend({},e.parser.parseOptions(m,[{ajax:"boolean",dirty:"boolean"}]),{url:(l.attr("action")?l.attr("action"):undefined)})};e.fn.form.defaults={fieldTypes:["tagbox","combobox","combotree","combogrid","combotreegrid","datetimebox","datebox","combo","datetimespinner","timespinner","numberspinner","spinner","slider","searchbox","numberbox","passwordbox","filebox","textbox","switchbutton","radiobutton","checkbox"],novalidate:false,ajax:true,iframe:true,dirty:false,dirtyFields:[],url:null,queryParams:{},onSubmit:function(l){return e(this).form("validate")},onProgress:function(l){},success:function(l){},onBeforeLoad:function(l){},onLoadSuccess:function(l){},onLoadError:function(){},onChange:function(l){}}})(jQuery);