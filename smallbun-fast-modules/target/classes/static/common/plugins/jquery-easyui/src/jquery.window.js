(function(e){function d(i,j){var h=e.data(i,"window");if(j){if(j.left!=null){h.options.left=j.left}if(j.top!=null){h.options.top=j.top}}e(i).panel("move",h.options);if(h.shadow){h.shadow.css({left:h.options.left,top:h.options.top})}}function f(m,i){var l=e.data(m,"window").options;var h=e(m).window("panel");var k=h._outerWidth();if(l.inline){var j=h.parent();l.left=Math.ceil((j.width()-k)/2+j.scrollLeft())}else{l.left=Math.ceil((e(window)._outerWidth()-k)/2+e(document).scrollLeft())}if(i){d(m)}}function c(m,j){var l=e.data(m,"window").options;var i=e(m).window("panel");var h=i._outerHeight();if(l.inline){var k=i.parent();l.top=Math.ceil((k.height()-h)/2+k.scrollTop())}else{l.top=Math.ceil((e(window)._outerHeight()-h)/2+e(document).scrollTop())}if(j){d(m)}}function b(l){var j=e.data(l,"window");var i=j.options;var k=e(l).panel(e.extend({},j.options,{border:false,doSize:true,closed:true,cls:"window "+(!i.border?"window-thinborder window-noborder ":(i.border=="thin"?"window-thinborder ":""))+(i.cls||""),headerCls:"window-header "+(i.headerCls||""),bodyCls:"window-body "+(i.noheader?"window-body-noheader ":" ")+(i.bodyCls||""),onBeforeDestroy:function(){if(i.onBeforeDestroy.call(l)==false){return false}if(j.shadow){j.shadow.remove()}if(j.mask){j.mask.remove()}},onClose:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}i.onClose.call(l)},onOpen:function(){if(j.mask){j.mask.css(e.extend({display:"block",zIndex:e.fn.window.defaults.zIndex++},e.fn.window.getMaskSize(l)))}if(j.shadow){j.shadow.css({display:"block",zIndex:e.fn.window.defaults.zIndex++,left:i.left,top:i.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}j.window.css("z-index",e.fn.window.defaults.zIndex++);i.onOpen.call(l)},onResize:function(n,m){var o=e(this).panel("options");e.extend(i,{width:o.width,height:o.height,left:o.left,top:o.top});if(j.shadow){j.shadow.css({left:i.left,top:i.top,width:j.window._outerWidth(),height:j.window._outerHeight()})}i.onResize.call(l,n,m)},onMinimize:function(){if(j.shadow){j.shadow.hide()}if(j.mask){j.mask.hide()}j.options.onMinimize.call(l)},onBeforeCollapse:function(){if(i.onBeforeCollapse.call(l)==false){return false}if(j.shadow){j.shadow.hide()}},onExpand:function(){if(j.shadow){j.shadow.show()}i.onExpand.call(l)}}));j.window=k.panel("panel");if(j.mask){j.mask.remove()}if(i.modal){j.mask=e('<div class="window-mask" style="display:none"></div>').insertAfter(j.window)}if(j.shadow){j.shadow.remove()}if(i.shadow){j.shadow=e('<div class="window-shadow" style="display:none"></div>').insertAfter(j.window)}var h=i.closed;if(i.left==null){f(l)}if(i.top==null){c(l)}d(l);if(!h){k.window("open")}}function g(k,n,j,p){var m=this;var i=e.data(m,"window");var h=i.options;if(!h.constrain){return{}}if(e.isFunction(h.constrain)){return h.constrain.call(m,k,n,j,p)}var l=e(m).window("window");var o=h.inline?l.parent():e(window);if(k<0){k=0}if(n<o.scrollTop()){n=o.scrollTop()}if(k+j>o.width()){if(j==l.outerWidth()){k=o.width()-j}else{j=o.width()-k}}if(n-o.scrollTop()+p>o.height()){if(p==l.outerHeight()){n=o.height()-p+o.scrollTop()}else{p=o.height()-n+o.scrollTop()}}return{left:k,top:n,width:j,height:p}}function a(l){var k=e.data(l,"window");k.window.draggable({handle:">div.panel-header>div.panel-title",disabled:k.options.draggable==false,onBeforeDrag:function(m){if(k.mask){k.mask.css("z-index",e.fn.window.defaults.zIndex++)}if(k.shadow){k.shadow.css("z-index",e.fn.window.defaults.zIndex++)}k.window.css("z-index",e.fn.window.defaults.zIndex++)},onStartDrag:function(m){j(m)},onDrag:function(m){h(m);return false},onStopDrag:function(m){i(m,"move")}});k.window.resizable({disabled:k.options.resizable==false,onStartResize:function(m){j(m)},onResize:function(m){h(m);return false},onStopResize:function(m){i(m,"resize")}});function j(m){if(k.pmask){k.pmask.remove()}k.pmask=e('<div class="window-proxy-mask"></div>').insertAfter(k.window);k.pmask.css({display:"none",zIndex:e.fn.window.defaults.zIndex++,left:m.data.left,top:m.data.top,width:k.window._outerWidth(),height:k.window._outerHeight()});if(k.proxy){k.proxy.remove()}k.proxy=e('<div class="window-proxy"></div>').insertAfter(k.window);k.proxy.css({display:"none",zIndex:e.fn.window.defaults.zIndex++,left:m.data.left,top:m.data.top});k.proxy._outerWidth(m.data.width)._outerHeight(m.data.height);k.proxy.hide();setTimeout(function(){if(k.pmask){k.pmask.show()}if(k.proxy){k.proxy.show()}},500)}function h(m){e.extend(m.data,g.call(l,m.data.left,m.data.top,m.data.width,m.data.height));k.pmask.show();k.proxy.css({display:"block",left:m.data.left,top:m.data.top});k.proxy._outerWidth(m.data.width);k.proxy._outerHeight(m.data.height)}function i(m,n){e.extend(m.data,g.call(l,m.data.left,m.data.top,m.data.width+0.1,m.data.height+0.1));e(l).window(n,m.data);k.pmask.remove();k.pmask=null;k.proxy.remove();k.proxy=null}}e(function(){if(!e._positionFixed){e(window).resize(function(){e("body>div.window-mask:visible").css({width:"",height:""});setTimeout(function(){e("body>div.window-mask:visible").css(e.fn.window.getMaskSize())},50)})}});e.fn.window=function(h,i){if(typeof h=="string"){var j=e.fn.window.methods[h];if(j){return j(this,i)}else{return this.panel(h,i)}}h=h||{};return this.each(function(){var k=e.data(this,"window");if(k){e.extend(k.options,h)}else{k=e.data(this,"window",{options:e.extend({},e.fn.window.defaults,e.fn.window.parseOptions(this),h)});if(!k.options.inline){document.body.appendChild(this)}}b(this);a(this)})};e.fn.window.methods={options:function(j){var i=j.panel("options");var h=e.data(j[0],"window").options;return e.extend(h,{closed:i.closed,collapsed:i.collapsed,minimized:i.minimized,maximized:i.maximized})},window:function(h){return e.data(h[0],"window").window},move:function(i,h){return i.each(function(){d(this,h)})},hcenter:function(h){return h.each(function(){f(this,true)})},vcenter:function(h){return h.each(function(){c(this,true)})},center:function(h){return h.each(function(){f(this);c(this);d(this)})}};e.fn.window.getMaskSize=function(i){var h=e(i).data("window");if(h&&h.options.inline){return{}}else{if(e._positionFixed){return{position:"fixed"}}else{return{width:e(document).width(),height:e(document).height()}}}};e.fn.window.parseOptions=function(h){return e.extend({},e.fn.panel.parseOptions(h),e.parser.parseOptions(h,[{draggable:"boolean",resizable:"boolean",shadow:"boolean",modal:"boolean",inline:"boolean"}]))};e.fn.window.defaults=e.extend({},e.fn.panel.defaults,{zIndex:9000,draggable:true,resizable:true,shadow:true,modal:false,border:true,inline:false,title:"New Window",collapsible:true,minimizable:true,maximizable:true,closable:true,closed:false,constrain:false})})(jQuery);