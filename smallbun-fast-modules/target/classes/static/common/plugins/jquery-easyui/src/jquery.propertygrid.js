(function(d){var b;d(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(g){var f=d(g.target).closest("div.datagrid-view,div.combo-panel");if(f.length){return}c(b);b=undefined});function e(h){var g=d.data(h,"propertygrid");var f=d.data(h,"propertygrid").options;d(h).datagrid(d.extend({},f,{cls:"propertygrid",view:(f.showGroup?f.groupView:f.view),onBeforeEdit:function(j,l){if(f.onBeforeEdit.call(h,j,l)==false){return false}var k=d(this);var l=k.datagrid("getRows")[j];var i=k.datagrid("getColumnOption","value");i.editor=l.editor},onClickCell:function(k,n,m){if(b!=this){c(b);b=this}if(f.editIndex!=k){c(b);d(this).datagrid("beginEdit",k);var j=d(this).datagrid("getEditor",{index:k,field:n});if(!j){j=d(this).datagrid("getEditor",{index:k,field:"value"})}if(j){var l=d(j.target);var i=l.data("textbox")?l.textbox("textbox"):l;i.focus();f.editIndex=k}}f.onClickCell.call(h,k,n,m)},loadFilter:function(i){c(this);return f.loadFilter.call(this,i)}}))}function c(h){var f=d(h);if(!f.length){return}var g=d.data(h,"propertygrid").options;g.finder.getTr(h,null,"editing").each(function(){var i=parseInt(d(this).attr("datagrid-row-index"));if(f.datagrid("validateRow",i)){f.datagrid("endEdit",i)}else{f.datagrid("cancelEdit",i)}});g.editIndex=undefined}d.fn.propertygrid=function(f,g){if(typeof f=="string"){var h=d.fn.propertygrid.methods[f];if(h){return h(this,g)}else{return this.datagrid(f,g)}}f=f||{};return this.each(function(){var j=d.data(this,"propertygrid");if(j){d.extend(j.options,f)}else{var i=d.extend({},d.fn.propertygrid.defaults,d.fn.propertygrid.parseOptions(this),f);i.frozenColumns=d.extend(true,[],i.frozenColumns);i.columns=d.extend(true,[],i.columns);d.data(this,"propertygrid",{options:i})}e(this)})};d.fn.propertygrid.methods={options:function(f){return d.data(f[0],"propertygrid").options}};d.fn.propertygrid.parseOptions=function(f){return d.extend({},d.fn.datagrid.parseOptions(f),d.parser.parseOptions(f,[{showGroup:"boolean"}]))};var a=d.extend({},d.fn.datagrid.defaults.view,{render:function(l,g,k){var j=[];var f=this.groups;for(var h=0;h<f.length;h++){j.push(this.renderGroup.call(this,l,h,f[h],k))}d(g).html(j.join(""))},renderGroup:function(y,h,n,w){var i=d.data(y,"datagrid");var q=i.options;var s=d(y).datagrid("getColumnFields",w);var m=q.frozenColumns&&q.frozenColumns.length;if(w){if(!(q.rownumbers||m)){return""}}var v=[];var p=q.groupStyler.call(y,n.value,n.rows);var k=x(p,"datagrid-group");v.push("<div group-index="+h+" "+k+">");if((w&&(q.rownumbers||q.frozenColumns.length))||(!w&&!(q.rownumbers||q.frozenColumns.length))){v.push('<span class="datagrid-group-expander">');v.push('<span class="datagrid-row-expander datagrid-row-collapse">&nbsp;</span>');v.push("</span>")}if((w&&m)||(!w)){v.push('<span class="datagrid-group-title">');v.push(q.groupFormatter.call(y,n.value,n.rows));v.push("</span>")}v.push("</div>");v.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var l=n.startIndex;for(var t=0;t<n.rows.length;t++){var p=q.rowStyler?q.rowStyler.call(y,l,n.rows[t]):"";var f="";var r="";if(typeof p=="string"){r=p}else{if(p){f=p["class"]||"";r=p.style||""}}var g='class="datagrid-row '+(l%2&&q.striped?"datagrid-row-alt ":" ")+f+'"';var u=r?'style="'+r+'"':"";var o=i.rowIdPrefix+"-"+(w?1:2)+"-"+l;v.push('<tr id="'+o+'" datagrid-row-index="'+l+'" '+g+" "+u+">");v.push(this.renderRow.call(this,y,s,w,l,n.rows[t]));v.push("</tr>");l++}v.push("</tbody></table>");return v.join("");function x(A,j){var B="";var z="";if(typeof A=="string"){z=A}else{if(A){B=A["class"]||"";z=A.style||""}}return'class="'+j+(B?" "+B:"")+'" style="'+z+'"'}},bindEvents:function(i){var h=d.data(i,"datagrid");var g=h.dc;var f=g.body1.add(g.body2);var j=(d.data(f[0],"events")||d._data(f[0],"events")).click[0].handler;f.unbind("click").bind("click",function(m){var l=d(m.target);var n=l.closest("span.datagrid-row-expander");if(n.length){var k=n.closest("div.datagrid-group").attr("group-index");if(n.hasClass("datagrid-row-collapse")){d(i).datagrid("collapseGroup",k)}else{d(i).datagrid("expandGroup",k)}}else{j(m)}m.stopPropagation()})},onBeforeRender:function(o,s){var g=d.data(o,"datagrid");var f=g.options;p();var h=[];for(var k=0;k<s.length;k++){var r=s[k];var q=j(r[f.groupField]);if(!q){q={value:r[f.groupField],rows:[r]};h.push(q)}else{q.rows.push(r)}}var n=0;var m=[];for(var k=0;k<h.length;k++){var q=h[k];q.startIndex=n;n+=q.rows.length;m=m.concat(q.rows)}g.data.rows=m;this.groups=h;var l=this;setTimeout(function(){l.bindEvents(o)},0);function j(u){for(var t=0;t<h.length;t++){var v=h[t];if(v.value==u){return v}}return null}function p(){if(!d("#datagrid-group-style").length){d("head").append('<style id="datagrid-group-style">.datagrid-group{height:'+f.groupHeight+"px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;white-space:nowrap;word-break:normal;}.datagrid-group-title,.datagrid-group-expander{display:inline-block;vertical-align:bottom;height:100%;line-height:"+f.groupHeight+"px;padding:0 4px;}.datagrid-group-title{position:relative;}.datagrid-group-expander{width:"+f.expanderWidth+"px;text-align:center;padding:0}.datagrid-row-expander{margin:"+Math.floor((f.groupHeight-16)/2)+"px 0;display:inline-block;width:16px;height:16px;cursor:pointer}</style>")}}},onAfterRender:function(i){d.fn.datagrid.defaults.view.onAfterRender.call(this,i);var f=this;var h=d.data(i,"datagrid");var g=h.options;if(!h.onResizeColumn){h.onResizeColumn=g.onResizeColumn}if(!h.onResize){h.onResize=g.onResize}g.onResizeColumn=function(k,j){f.resizeGroup(i);h.onResizeColumn.call(i,k,j)};g.onResize=function(k,j){f.resizeGroup(i);h.onResize.call(d(i).datagrid("getPanel")[0],k,j)};f.resizeGroup(i)}});d.extend(d.fn.datagrid.methods,{groups:function(f){return f.datagrid("options").view.groups},expandGroup:function(g,f){return g.each(function(){var i=d(this).datagrid("options");var h=d.data(this,"datagrid").dc.view;var j=h.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var k=j.find("span.datagrid-row-expander");if(k.hasClass("datagrid-row-expand")){k.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");j.next("table").show()}d(this).datagrid("fixRowHeight");if(i.onExpandGroup){i.onExpandGroup.call(this,f)}})},collapseGroup:function(g,f){return g.each(function(){var i=d(this).datagrid("options");var h=d.data(this,"datagrid").dc.view;var j=h.find(f!=undefined?'div.datagrid-group[group-index="'+f+'"]':"div.datagrid-group");var k=j.find("span.datagrid-row-expander");if(k.hasClass("datagrid-row-collapse")){k.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");j.next("table").hide()}d(this).datagrid("fixRowHeight");if(i.onCollapseGroup){i.onCollapseGroup.call(this,f)}})},scrollToGroup:function(g,f){return g.each(function(){var l=d.data(this,"datagrid");var j=l.dc;var n=j.body2.children('div.datagrid-group[group-index="'+f+'"]');if(n.length){var k=n.outerHeight();var i=j.view2.children("div.datagrid-header")._outerHeight();var h=j.body2.outerHeight(true)-j.body2.outerHeight();var m=n.position().top-i-h;if(m<0){j.body2.scrollTop(j.body2.scrollTop()+m)}else{if(m+k>j.body2.height()-18){j.body2.scrollTop(j.body2.scrollTop()+m+k-j.body2.height()+18)}}}})}});d.extend(a,{refreshGroupTitle:function(l,j){var i=d.data(l,"datagrid");var h=i.options;var f=i.dc;var k=this.groups[j];var g=f.body1.add(f.body2).children("div.datagrid-group[group-index="+j+"]").find("span.datagrid-group-title");g.html(h.groupFormatter.call(l,k.value,k.rows))},resizeGroup:function(l,o){var g=d.data(l,"datagrid");var p=g.dc;var n=p.header2.find("table");var k=n.find("tr.datagrid-filter-row").hide();var j=p.body2.children("table.datagrid-btable:first").width();if(o==undefined){var i=p.body2.children("div.datagrid-group")}else{var i=p.body2.children("div.datagrid-group[group-index="+o+"]")}i._outerWidth(j);var f=g.options;if(f.frozenColumns&&f.frozenColumns.length){var h=p.view1.width()-f.expanderWidth;var m=p.view1.css("direction").toLowerCase()=="rtl";i.find(".datagrid-group-title").css(m?"right":"left",-h+"px")}if(k.length){if(f.showFilterBar){k.show()}}},insertRow:function(l,k,p){var g=d.data(l,"datagrid");var f=g.options;var o=g.dc;var m=null;var n;if(!g.data.rows.length){d(l).datagrid("loadData",[p]);return}for(var j=0;j<this.groups.length;j++){if(this.groups[j].value==p[f.groupField]){m=this.groups[j];n=j;break}}if(m){if(k==undefined||k==null){k=g.data.rows.length}if(k<m.startIndex){k=m.startIndex}else{if(k>m.startIndex+m.rows.length){k=m.startIndex+m.rows.length}}d.fn.datagrid.defaults.view.insertRow.call(this,l,k,p);if(k>=m.startIndex+m.rows.length){h(k,true);h(k,false)}m.rows.splice(k-m.startIndex,0,p)}else{m={value:p[f.groupField],rows:[p],startIndex:g.data.rows.length};n=this.groups.length;o.body1.append(this.renderGroup.call(this,l,n,m,true));o.body2.append(this.renderGroup.call(this,l,n,m,false));this.groups.push(m);g.data.rows.push(p)}this.setGroupIndex(l);this.refreshGroupTitle(l,n);this.resizeGroup(l);function h(i,t){var r=t?1:2;var q=f.finder.getTr(l,i-1,"body",r);var s=f.finder.getTr(l,i,"body",r);s.insertAfter(q)}},updateRow:function(j,g,k){var h=d.data(j,"datagrid").options;d.fn.datagrid.defaults.view.updateRow.call(this,j,g,k);var f=h.finder.getTr(j,g,"body",2).closest("table.datagrid-btable");var i=parseInt(f.prev().attr("group-index"));this.refreshGroupTitle(j,i)},deleteRow:function(m,l){var g=d.data(m,"datagrid");var f=g.options;var p=g.dc;var k=p.body1.add(p.body2);var h=f.finder.getTr(m,l,"body",2).closest("table.datagrid-btable");var o=parseInt(h.prev().attr("group-index"));d.fn.datagrid.defaults.view.deleteRow.call(this,m,l);var n=this.groups[o];if(n.rows.length>1){n.rows.splice(l-n.startIndex,1);this.refreshGroupTitle(m,o)}else{k.children("div.datagrid-group[group-index="+o+"]").remove();for(var j=o+1;j<this.groups.length;j++){k.children("div.datagrid-group[group-index="+j+"]").attr("group-index",j-1)}this.groups.splice(o,1)}this.setGroupIndex(m)},setGroupIndex:function(j){var f=0;for(var g=0;g<this.groups.length;g++){var h=this.groups[g];h.startIndex=f;f+=h.rows.length}}});d.fn.propertygrid.defaults=d.extend({},d.fn.datagrid.defaults,{groupHeight:28,expanderWidth:20,singleSelect:true,remoteSort:false,fitColumns:true,loadMsg:"",frozenColumns:[[{field:"f",width:20,resizable:false}]],columns:[[{field:"name",title:"Name",width:100,sortable:true},{field:"value",title:"Value",width:100,resizable:false}]],showGroup:false,groupView:a,groupField:"group",groupStyler:function(g,f){return""},groupFormatter:function(f,g){return f}})})(jQuery);