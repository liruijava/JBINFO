(function(f){function r(u,t){var s=f.data(u,"combobox");return f.easyui.indexOfArray(s.data,s.options.valueField,t)}function b(x,w){var v=f.data(x,"combobox").options;var s=f(x).combo("panel");var u=v.finder.getEl(x,w);if(u.length){if(u.position().top<=0){var t=s.scrollTop()+u.position().top;s.scrollTop(t)}else{if(u.position().top+u.outerHeight()>s.height()){var t=s.scrollTop()+u.position().top+u.outerHeight()-s.height();s.scrollTop(t)}}}s.triggerHandler("scroll")}function i(y,u){var w=f.data(y,"combobox").options;var s=f(y).combobox("panel");var v=s.children("div.combobox-item-hover");if(!v.length){v=s.children("div.combobox-item-selected")}v.removeClass("combobox-item-hover");var x="div.combobox-item:visible:not(.combobox-item-disabled):first";var t="div.combobox-item:visible:not(.combobox-item-disabled):last";if(!v.length){v=s.children(u=="next"?x:t)}else{if(u=="next"){v=v.nextAll(x);if(!v.length){v=s.children(x)}}else{v=v.prevAll(x);if(!v.length){v=s.children(t)}}}if(v.length){v.addClass("combobox-item-hover");var z=w.finder.getRow(y,v);if(z){f(y).combobox("scrollTo",z[w.valueField]);if(w.selectOnNavigation){o(y,z[w.valueField])}}}}function o(w,v,u){var t=f.data(w,"combobox").options;var s=f(w).combo("getValues");if(f.inArray(v+"",s)==-1){if(t.multiple){s.push(v)}else{s=[v]}q(w,s,u)}}function l(w,v){var u=f.data(w,"combobox").options;var s=f(w).combo("getValues");var t=f.inArray(v+"",s);if(t>=0){s.splice(t,1);q(w,s)}}function q(B,E,A){var t=f.data(B,"combobox").options;var u=f(B).combo("panel");if(!f.isArray(E)){E=E.split(t.separator)}if(!t.multiple){E=E.length?[E[0]]:[""]}var F=f(B).combo("getValues");if(u.is(":visible")){u.find(".combobox-item-selected").each(function(){var s=t.finder.getRow(B,f(this));if(s){if(f.easyui.indexOfArray(F,s[t.valueField])==-1){f(this).removeClass("combobox-item-selected")}}})}f.map(F,function(s){if(f.easyui.indexOfArray(E,s)==-1){var K=t.finder.getEl(B,s);if(K.hasClass("combobox-item-selected")){K.removeClass("combobox-item-selected");t.onUnselect.call(B,t.finder.getRow(B,s))}}});var x=null;var C=[],J=[];for(var z=0;z<E.length;z++){var D=E[z];var I=D;var H=t.finder.getRow(B,D);if(H){I=H[t.textField];x=H;var w=t.finder.getEl(B,D);if(!w.hasClass("combobox-item-selected")){w.addClass("combobox-item-selected");t.onSelect.call(B,H)}}else{I=G(D,t.mappingRows)||D}C.push(D);J.push(I)}if(!A){f(B).combo("setText",J.join(t.separator))}if(t.showItemIcon){var y=f(B).combobox("textbox");y.removeClass("textbox-bgicon "+t.textboxIconCls);if(x&&x.iconCls){y.addClass("textbox-bgicon "+x.iconCls);t.textboxIconCls=x.iconCls}}f(B).combo("setValues",C);u.triggerHandler("scroll");function G(K,s){var v=f.easyui.getArrayItem(s,t.valueField,K);return v?v[t.textField]:undefined}}function a(x,w,t){var v=f.data(x,"combobox");var s=v.options;v.data=s.loadFilter.call(x,w);s.view.render.call(s.view,x,f(x).combo("panel"),v.data);var u=f(x).combobox("getValues");f.easyui.forEach(v.data,false,function(y){if(y.selected){f.easyui.addArrayItem(u,y[s.valueField]+"")}});if(s.multiple){q(x,u,t)}else{q(x,u.length?[u[u.length-1]]:[],t)}s.onLoadSuccess.call(x,w)}function d(v,s,w,u){var t=f.data(v,"combobox").options;if(s){t.url=s}w=f.extend({},t.queryParams,w||{});if(t.onBeforeLoad.call(v,w)==false){return}t.loader.call(v,w,function(x){a(v,x,u)},function(){t.onLoadError.apply(this,arguments)})}function c(z,u){var v=f.data(z,"combobox");var s=v.options;var x=f();var A=s.multiple?u.split(s.separator):[u];if(s.mode=="remote"){y(A);d(z,null,{q:u},true)}else{var t=f(z).combo("panel");t.find(".combobox-item-hover").removeClass("combobox-item-hover");t.find(".combobox-item,.combobox-group").hide();var w=v.data;var B=[];f.map(A,function(C){C=f.trim(C);var F=C;var G=undefined;x=f();for(var D=0;D<w.length;D++){var J=w[D];if(s.filter.call(z,C,J)){var H=J[s.valueField];var K=J[s.textField];var E=J[s.groupField];var I=s.finder.getEl(z,H).show();if(K.toLowerCase()==C.toLowerCase()){F=H;if(s.reversed){x=I}else{o(z,H,true)}}if(s.groupField&&G!=E){s.finder.getGroupEl(z,E).show();G=E}}}B.push(F)});y(B)}function y(C){if(s.reversed){x.addClass("combobox-item-hover")}else{q(z,s.multiple?(u?C:[]):C,true)}}}function p(z){var u=f(z);var w=u.combobox("options");var s=u.combobox("panel");var v=s.children("div.combobox-item-hover");if(v.length){v.removeClass("combobox-item-hover");var A=w.finder.getRow(z,v);var y=A[w.valueField];if(w.multiple){if(v.hasClass("combobox-item-selected")){u.combobox("unselect",y)}else{u.combobox("select",y)}}else{u.combobox("select",y)}}var x=[];f.map(u.combobox("getValues"),function(t){if(r(z,t)>=0){x.push(t)}});u.combobox("setValues",x);if(!w.multiple){u.combobox("hidePanel")}}function k(u){var t=f.data(u,"combobox");var s=t.options;f(u).addClass("combobox-f");f(u).combo(f.extend({},s,{onShowPanel:function(){f(this).combo("panel").find("div.combobox-item:hidden,div.combobox-group:hidden").show();q(this,f(this).combobox("getValues"),true);f(this).combobox("scrollTo",f(this).combobox("getValue"));s.onShowPanel.call(this)}}))}function m(t){f(this).children("div.combobox-item-hover").removeClass("combobox-item-hover");var s=f(t.target).closest("div.combobox-item");if(!s.hasClass("combobox-item-disabled")){s.addClass("combobox-item-hover")}t.stopPropagation()}function h(s){f(s.target).closest("div.combobox-item").removeClass("combobox-item-hover");s.stopPropagation()}function j(w){var v=f(this).panel("options").comboTarget;if(!v){return}var t=f(v).combobox("options");var s=f(w.target).closest("div.combobox-item");if(!s.length||s.hasClass("combobox-item-disabled")){return}var x=t.finder.getRow(v,s);if(!x){return}if(t.blurTimer){clearTimeout(t.blurTimer);t.blurTimer=null}t.onClick.call(v,x);var u=x[t.valueField];if(t.multiple){if(s.hasClass("combobox-item-selected")){l(v,u)}else{o(v,u)}}else{f(v).combobox("setValue",u).combobox("hidePanel")}w.stopPropagation()}function g(w){var v=f(this).panel("options").comboTarget;if(!v){return}var t=f(v).combobox("options");if(t.groupPosition=="sticky"){var s=f(this).children(".combobox-stick");if(!s.length){s=f('<div class="combobox-stick"></div>').appendTo(this)}s.hide();var u=f(v).data("combobox");f(this).children(".combobox-group:visible").each(function(){var z=f(this);var x=t.finder.getGroup(v,z);var A=u.data[x.startIndex+x.count-1];var y=t.finder.getEl(v,A[t.valueField]);if(z.position().top<0&&y.position().top>0){s.show().html(z.html());return false}})}}f.fn.combobox=function(s,t){if(typeof s=="string"){var u=f.fn.combobox.methods[s];if(u){return u(this,t)}else{return this.combo(s,t)}}s=s||{};return this.each(function(){var w=f.data(this,"combobox");if(w){f.extend(w.options,s)}else{w=f.data(this,"combobox",{options:f.extend({},f.fn.combobox.defaults,f.fn.combobox.parseOptions(this),s),data:[]})}k(this);if(w.options.data){a(this,w.options.data)}else{var v=f.fn.combobox.parseData(this);if(v.length){a(this,v)}}d(this)})};f.fn.combobox.methods={options:function(t){var s=t.combo("options");return f.extend(f.data(t[0],"combobox").options,{width:s.width,height:s.height,originalValue:s.originalValue,disabled:s.disabled,readonly:s.readonly})},cloneFrom:function(t,s){return t.each(function(){f(this).combo("cloneFrom",s);f.data(this,"combobox",f(s).data("combobox"));f(this).addClass("combobox-f").attr("comboboxName",f(this).attr("textboxName"))})},getData:function(s){return f.data(s[0],"combobox").data},setValues:function(t,s){return t.each(function(){var u=f(this).combobox("options");if(f.isArray(s)){s=f.map(s,function(v){if(v&&typeof v=="object"){f.easyui.addArrayItem(u.mappingRows,u.valueField,v);return v[u.valueField]}else{return v}})}q(this,s)})},setValue:function(t,s){return t.each(function(){f(this).combobox("setValues",f.isArray(s)?s:[s])})},clear:function(s){return s.each(function(){q(this,[])})},reset:function(s){return s.each(function(){var t=f(this).combobox("options");if(t.multiple){f(this).combobox("setValues",t.originalValue)}else{f(this).combobox("setValue",t.originalValue)}})},loadData:function(t,s){return t.each(function(){a(this,s)})},reload:function(t,s){return t.each(function(){if(typeof s=="string"){d(this,s)}else{if(s){var u=f(this).combobox("options");u.queryParams=s}d(this)}})},select:function(t,s){return t.each(function(){o(this,s)})},unselect:function(t,s){return t.each(function(){l(this,s)})},scrollTo:function(t,s){return t.each(function(){b(this,s)})}};f.fn.combobox.parseOptions=function(u){var s=f(u);return f.extend({},f.fn.combo.parseOptions(u),f.parser.parseOptions(u,["valueField","textField","groupField","groupPosition","mode","method","url",{showItemIcon:"boolean",limitToList:"boolean"}]))};f.fn.combobox.parseData=function(v){var u=[];var t=f(v).combobox("options");f(v).children().each(function(){if(this.tagName.toLowerCase()=="optgroup"){var w=f(this).attr("label");f(this).children().each(function(){s(this,w)})}else{s(this)}});return u;function s(x,y){var w=f(x);var z={};z[t.valueField]=w.attr("value")!=undefined?w.attr("value"):w.text();z[t.textField]=w.text();z.iconCls=f.parser.parseOptions(x,["iconCls"]).iconCls;z.selected=w.is(":selected");z.disabled=w.is(":disabled");if(y){t.groupField=t.groupField||"group";z[t.groupField]=y}u.push(z)}};var e=0;var n={render:function(A,w,x){var u=f.data(A,"combobox");var t=u.options;e++;u.itemIdPrefix="_easyui_combobox_i"+e;u.groupIdPrefix="_easyui_combobox_g"+e;u.groups=[];var D=[];var C=undefined;for(var y=0;y<x.length;y++){var G=x[y];var B=G[t.valueField]+"";var F=G[t.textField];var z=G[t.groupField];if(z){if(C!=z){C=z;u.groups.push({value:z,startIndex:y,count:1});D.push('<div id="'+(u.groupIdPrefix+"_"+(u.groups.length-1))+'" class="combobox-group">');D.push(t.groupFormatter?t.groupFormatter.call(A,z):z);D.push("</div>")}else{u.groups[u.groups.length-1].count++}}else{C=undefined}var E="combobox-item"+(G.disabled?" combobox-item-disabled":"")+(z?" combobox-gitem":"");D.push('<div id="'+(u.itemIdPrefix+"_"+y)+'" class="'+E+'">');if(t.showItemIcon&&G.iconCls){D.push('<span class="combobox-icon '+G.iconCls+'"></span>')}D.push(t.formatter?t.formatter.call(A,G):F);D.push("</div>")}f(w).html(D.join(""))}};f.fn.combobox.defaults=f.extend({},f.fn.combo.defaults,{valueField:"value",textField:"text",groupPosition:"static",groupField:null,groupFormatter:function(s){return s},mode:"local",method:"post",url:null,data:null,queryParams:{},showItemIcon:false,limitToList:false,unselectedValues:[],mappingRows:[],view:n,keyHandler:{up:function(s){i(this,"prev");s.preventDefault()},down:function(s){i(this,"next");s.preventDefault()},left:function(s){},right:function(s){},enter:function(s){p(this)},query:function(s,t){c(this,s)}},inputEvents:f.extend({},f.fn.combo.defaults.inputEvents,{blur:function(u){f.fn.combo.defaults.inputEvents.blur(u);var t=u.data.target;var s=f(t).combobox("options");if(s.reversed||s.limitToList){if(s.blurTimer){clearTimeout(s.blurTimer)}s.blurTimer=setTimeout(function(){var v=f(t).parent().length;if(v){if(s.reversed){f(t).combobox("setValues",f(t).combobox("getValues"))}else{if(s.limitToList){var w=[];f.map(f(t).combobox("getValues"),function(x){var y=f.easyui.indexOfArray(f(t).combobox("getData"),s.valueField,x);if(y>=0){w.push(x)}});f(t).combobox("setValues",w)}}s.blurTimer=null}},50)}}}),panelEvents:{mouseover:m,mouseout:h,mousedown:function(s){s.preventDefault();s.stopPropagation()},click:j,scroll:g},filter:function(t,u){var s=f(this).combobox("options");return u[s.textField].toLowerCase().indexOf(t.toLowerCase())>=0},formatter:function(t){var s=f(this).combobox("options");return t[s.textField]},loader:function(v,u,s){var t=f(this).combobox("options");if(!t.url){return false}f.ajax({type:t.method,url:t.url,data:v,dataType:"json",success:function(w){u(w)},error:function(){s.apply(this,arguments)}})},loadFilter:function(s){return s},finder:{getEl:function(u,t){var s=r(u,t);var v=f.data(u,"combobox").itemIdPrefix+"_"+s;return f("#"+v)},getGroupEl:function(v,t){var u=f.data(v,"combobox");var s=f.easyui.indexOfArray(u.groups,"value",t);var w=u.groupIdPrefix+"_"+s;return f("#"+w)},getGroup:function(v,u){var t=f.data(v,"combobox");var s=u.attr("id").substr(t.groupIdPrefix.length+1);return t.groups[parseInt(s)]},getRow:function(v,u){var t=f.data(v,"combobox");var s=(u instanceof f)?u.attr("id").substr(t.itemIdPrefix.length+1):r(v,u);return t.data[parseInt(s)]}},onBeforeLoad:function(s){},onLoadSuccess:function(s){},onLoadError:function(){},onSelect:function(s){},onUnselect:function(s){},onClick:function(s){}})})(jQuery);