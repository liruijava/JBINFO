var ERROR="error";var CAPTCHA="captcha";var OK="ok";function reloadCode(){$(".captcha").removeClass("has-success");$("#KAPTCHA_SESSION_KEY").val(null);$("#captcha").attr("src",contextPath+"captcha?"+Math.random())}$(document).ready(function(){$("#form").bootstrapValidator({fields:{username:{feedbackIcons:false,validators:{notEmpty:{message:"用户名不能为空"}}},password:{feedbackIcons:false,validators:{notEmpty:{message:"密码不能为空"}}},KAPTCHA_SESSION_KEY:{feedbackIcons:false,validators:{notEmpty:{message:"验证码不能为空"}}}}}).on("success.form.bv",function(a){a.preventDefault();var b=new JSEncrypt();$.ajax({url:contextPath+"key",type:"post",async:false,dataType:"json",success:function(c){b.setPublicKey(c.result)}});$.ajax({url:contextPath+"login",type:"post",async:false,dataType:"json",data:{password:b.encrypt($("#password").val()),username:$("#username").val(),KAPTCHA_SESSION_KEY:$("#KAPTCHA_SESSION_KEY").val(),},success:function(c){if(OK===c.status){location.href="/index"}if(CAPTCHA===c.status){$("#msg").empty().append("验证码错误");reloadCode()}if(ERROR===c.status){$("#msg").empty().append(c.msg);reloadCode();$(".username").removeClass("has-success");$(".password").removeClass("has-success");$("#password").val(null);$("#username").val(null)}}})})});